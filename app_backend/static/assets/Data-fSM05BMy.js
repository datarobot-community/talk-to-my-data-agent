import{u as U,a as D,j as a,B as L,F as w,r as x,R as J,I as X,l as B,b as Y,c as Z,d as ee,e as ae,f as p,D as T,g as se,h as te,i as ne,S as ie}from"./index-jHo7rD02.js";import{f as $,u as re,L as Q,a as le,S as ce}from"./loading-qniM0Q3I.js";import{T as K,a as H,b as E,c as M,d as W,e as S,f as oe,g as de,h as fe,i as F}from"./tabs-CtbE-zl1.js";const ue=({onClear:e})=>{const{mutate:n}=U(),{t:i}=D(),t=()=>{n(),e&&e()};return a.jsxs(L,{testId:"clear-datasets-button",variant:"ghost",onClick:t,children:[a.jsx(w,{icon:$.faTrash}),i("Clear all datasets")]})};var I={},A;function he(){return A||(A=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var n="fas",i="download",t=512,c=512,s=[],r="f019",l="M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 242.7-73.4-73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l128-128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L288 274.7 288 32zM64 352c-35.3 0-64 28.7-64 64l0 32c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-32c0-35.3-28.7-64-64-64l-101.5 0-45.3 45.3c-25 25-65.5 25-90.5 0L165.5 352 64 352zm368 56a24 24 0 1 1 0 48 24 24 0 1 1 0-48z";e.definition={prefix:n,iconName:i,icon:[t,c,s,r,l]},e.faDownload=e.definition,e.prefix=n,e.iconName=i,e.width=t,e.height=c,e.ligatures=s,e.unicode=r,e.svgPathData=l,e.aliases=s}(I)),I}var ge=he();const O=({initialValue:e,rowIndex:n,field:i,onUpdate:t})=>{const[c,s]=x.useState(!1),[r,l]=x.useState(e);J.useEffect(()=>{l(e)},[e]);const o=()=>{s(!0)},u=()=>{s(!1),r!==e&&t&&t(n,i,r)},h=f=>{f.key==="Enter"?(f.preventDefault(),s(!1),r!==e&&t&&t(n,i,r)):f.key==="Escape"&&(s(!1),l(e))};return c?a.jsx(X,{value:r,onChange:f=>l(f.target.value),onBlur:u,onKeyDown:h,autoFocus:!0,className:"w-full h-[28px]"}):a.jsx("div",{onDoubleClick:o,className:"cursor-pointer hover:bg-secondary p-1 rounded min-h-[28px]",title:"Double-click to edit",children:r})},me=({data:e,onUpdateCell:n})=>{var c;const{t:i}=D(),t=(s,r,l)=>{n&&n(s,r,l)};return a.jsxs(K,{children:[a.jsx(H,{className:"bg-background",children:a.jsxs(E,{children:[a.jsx(M,{className:"w-[200px]",children:i("Column")}),a.jsx(M,{children:i("Type")}),a.jsx(M,{children:i("Description")})]})}),a.jsx(W,{children:(c=e.column_descriptions)==null?void 0:c.map((s,r)=>a.jsxs(E,{children:[a.jsx(S,{className:"font-medium",children:s.column}),a.jsx(S,{children:a.jsx(O,{initialValue:s.data_type,rowIndex:r,field:"data_type",onUpdate:t})}),a.jsx(S,{children:a.jsx(O,{initialValue:s.description,rowIndex:r,field:"description",onUpdate:t})})]},s.column))})]})};var k=new Map,C=new WeakMap,G=0,xe=void 0;function ve(e){return e?(C.has(e)||(G+=1,C.set(e,G.toString())),C.get(e)):"0"}function je(e){return Object.keys(e).sort().filter(n=>e[n]!==void 0).map(n=>`${n}_${n==="root"?ve(e.root):e[n]}`).toString()}function Ne(e){const n=je(e);let i=k.get(n);if(!i){const t=new Map;let c;const s=new IntersectionObserver(r=>{r.forEach(l=>{var o;const u=l.isIntersecting&&c.some(h=>l.intersectionRatio>=h);e.trackVisibility&&typeof l.isVisible>"u"&&(l.isVisible=u),(o=t.get(l.target))==null||o.forEach(h=>{h(u,l)})})},e);c=s.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),i={id:n,observer:s,elements:t},k.set(n,i)}return i}function we(e,n,i={},t=xe){if(typeof window.IntersectionObserver>"u"&&t!==void 0){const o=e.getBoundingClientRect();return n(t,{isIntersecting:t,target:e,intersectionRatio:typeof i.threshold=="number"?i.threshold:0,time:0,boundingClientRect:o,intersectionRect:o,rootBounds:o}),()=>{}}const{id:c,observer:s,elements:r}=Ne(i),l=r.get(e)||[];return r.has(e)||r.set(e,l),l.push(n),s.observe(e),function(){l.splice(l.indexOf(n),1),l.length===0&&(r.delete(e),s.unobserve(e)),r.size===0&&(s.disconnect(),k.delete(c))}}function be({threshold:e,delay:n,trackVisibility:i,rootMargin:t,root:c,triggerOnce:s,skip:r,initialInView:l,fallbackInView:o,onChange:u}={}){var h;const[f,j]=x.useState(null),v=x.useRef(u),[d,g]=x.useState({inView:!!l,entry:void 0});v.current=u,x.useEffect(()=>{if(r||!f)return;let b;return b=we(f,(z,R)=>{g({inView:z,entry:R}),v.current&&v.current(z,R),R.isIntersecting&&s&&b&&(b(),b=void 0)},{root:c,rootMargin:t,threshold:e,trackVisibility:i,delay:n},o),()=>{b&&b()}},[Array.isArray(e)?e.toString():e,f,c,t,s,r,i,o,n]);const m=(h=d.entry)==null?void 0:h.target,y=x.useRef(void 0);!f&&m&&!s&&!r&&y.current!==m&&(y.current=m,g({inView:!!l,entry:void 0}));const N=[j,d.inView,d.entry];return N.ref=N[0],N.inView=N[1],N.entry=N[2],N}const pe=({datasetName:e,rowsPerPage:n=50})=>{const{ref:i,inView:t}=be(),{t:c}=D(),{data:s,fetchNextPage:r,hasNextPage:l,isFetchingNextPage:o,status:u,isError:h,error:f}=re(e,n);x.useEffect(()=>{t&&l&&!o&&r()},[t,r,l,o]);const j=x.useMemo(()=>s?s.pages.flatMap(d=>d.dataset.data_records):[],[s]),v=x.useMemo(()=>{var d,g;return!s||!((g=(d=s.pages[0])==null?void 0:d.dataset)!=null&&g.data_records[0])?[]:Object.keys(s.pages[0].dataset.data_records[0])},[s]);return u==="pending"?a.jsx("div",{className:"h-96",children:a.jsx(Q,{})}):h?a.jsxs("div",{className:"flex flex-col flex-1 items-center justify-center h-96",children:[c("Error loading data"),": ",String(f)]}):j.length===0?a.jsx("div",{className:"flex flex-col flex-1 items-center justify-center h-96",children:c("No data available for this dataset.")}):a.jsxs("div",{className:"w-full overflow-auto",children:[a.jsxs(K,{children:[a.jsx(H,{className:"bg-background",children:a.jsx(E,{children:v.map(d=>a.jsx(M,{children:d},d))})}),a.jsx(W,{children:j.map((d,g)=>a.jsx(E,{children:v.map(m=>a.jsx(S,{children:d[m]!==null&&d[m]!==void 0?String(d[m]):""},m))},g))})]}),a.jsx("div",{ref:i,className:"w-full text-center p-4",children:o?a.jsxs("div",{className:"flex justify-center items-center",children:[a.jsx("img",{src:B,alt:c("processing"),className:"mr-2 w-4 h-4 animate-spin"}),a.jsx("span",{className:"ml-2",children:c("Loading more...")})]}):l?a.jsx("div",{className:"h-10"}):a.jsx("div",{className:"text-muted-foreground",children:j.length>0?c("End of data"):c("No data available")})})]})},De=({dictionary:e,isProcessing:n=!0,viewMode:i="description"})=>{var j,v;const{t}=D(),{mutate:c}=Y(),{mutate:s}=Z(),{mutate:r,isPending:l}=ee(),{data:o,isLoading:u}=le(e.name),h=d=>{if(d===0)return"0 Bytes";const g=1024,m=["Bytes","KB","MB","GB","TB"],y=Math.floor(Math.log(d)/Math.log(g));return parseFloat((d/Math.pow(g,y)).toFixed(2))+" "+m[y]},f=o!=null&&o.file_size?h(o.file_size):"0 MB";return a.jsxs("div",{className:ae("flex flex-col w-full bg-card p-4",{"h-[400px]":n}),children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg",children:a.jsx("strong",{children:e.name})}),a.jsxs("div",{className:"flex justify-between pt-1",children:[a.jsxs("div",{className:"flex gap-2 my-1",children:[a.jsx(p,{variant:"secondary",className:"leading-tight text-sm",children:u?t("Loading..."):`${((j=o==null?void 0:o.columns)==null?void 0:j.length)||0} ${t("features")}`}),a.jsx(p,{variant:"secondary",className:"leading-tight text-sm",children:u?t("Loading..."):`${((v=o==null?void 0:o.row_count)==null?void 0:v.toLocaleString())||0} ${t("rows")}`}),a.jsx(p,{variant:"secondary",className:"leading-tight text-sm",children:u?t("Loading..."):f}),a.jsx(p,{variant:"secondary",className:"leading-tight text-sm",children:(o==null?void 0:o.data_source)||t("file")}),n?a.jsxs(p,{variant:"outline",className:"leading-tight text-sm",children:[a.jsx("img",{src:B,alt:t("processing"),className:"mr-2 w-4 h-4 animate-spin"}),t("Processing...")]}):a.jsxs(p,{variant:"success",testId:"data-processed-badge",className:"leading-tight text-sm",children:[a.jsx(w,{className:"mr-2 w-4 h-4 ",icon:oe.faCheck}),t("Processed")]})]}),a.jsxs("div",{className:"flex gap-2 px-2",children:[a.jsx(L,{variant:"link",onClick:()=>{r({name:e.name})},title:t("Download dictionary as CSV"),disabled:n||l,children:l?a.jsx("img",{src:B,alt:t("downloading"),className:"w-4 h-4 animate-spin"}):a.jsx(w,{icon:ge.faDownload})}),a.jsx(L,{variant:"link",onClick:()=>{c({name:e.name})},title:t("Delete dictionary"),children:a.jsx(w,{icon:$.faTrash})})]})]})]}),a.jsx("div",{className:"flex flex-col flex-1 text-lg",children:n?a.jsx("div",{className:"flex flex-col flex-1 items-center justify-center",children:t("Processing the dataset may take a few minutes...")}):a.jsx(ce,{className:"mt-4 h-96",children:i===T.DESCRIPTION?a.jsx(me,{data:e,onUpdateCell:(d,g,m)=>{s({name:e.name,rowIndex:d,field:g,value:m},{onError:()=>{}})}}):a.jsx(pe,{datasetName:e.name,rowsPerPage:50})})})]})};var P={},V;function ye(){return V||(V=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var n="fas",i="quote-left",t=448,c=512,s=[8220,"quote-left-alt"],r="f10d",l="M0 216C0 149.7 53.7 96 120 96l8 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-8 0c-30.9 0-56 25.1-56 56l0 8 64 0c35.3 0 64 28.7 64 64l0 64c0 35.3-28.7 64-64 64l-64 0c-35.3 0-64-28.7-64-64l0-32 0-32 0-72zm256 0c0-66.3 53.7-120 120-120l8 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-8 0c-30.9 0-56 25.1-56 56l0 8 64 0c35.3 0 64 28.7 64 64l0 64c0 35.3-28.7 64-64 64l-64 0c-35.3 0-64-28.7-64-64l0-32 0-32 0-72z";e.definition={prefix:n,iconName:i,icon:[t,c,s,r,l]},e.faQuoteLeft=e.definition,e.prefix=n,e.iconName=i,e.width=t,e.height=c,e.ligatures=s,e.unicode=r,e.svgPathData=l,e.aliases=s}(P)),P}var Te=ye();const Ce=({defaultValue:e=T.DESCRIPTION,onChange:n})=>{const{t:i}=D();return a.jsx(de,{defaultValue:e,onValueChange:n,className:"w-fit py-4",children:a.jsxs(fe,{className:"grid w-full grid-cols-2",children:[a.jsxs(F,{value:T.DESCRIPTION,"data-testid":"description-tab",children:[a.jsx(w,{className:"mr-2",icon:Te.faQuoteLeft}),i("Description")]}),a.jsxs(F,{value:T.RAW,"data-testid":"raw-tab",children:[a.jsx(w,{className:"mr-2",icon:se.faTable}),i("Raw rows")]})]})})};var _={},q;function Me(){return q||(q=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var n="fas",i="magnifying-glass",t=512,c=512,s=[128269,"search"],r="f002",l="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z";e.definition={prefix:n,iconName:i,icon:[t,c,s,r,l]},e.faMagnifyingGlass=e.definition,e.prefix=n,e.iconName=i,e.width=t,e.height=c,e.ligatures=s,e.unicode=r,e.svgPathData=l,e.aliases=s}(_)),_}var Se=Me();const Ee=()=>{const{t:e}=te();return a.jsxs("div",{children:[a.jsx(w,{className:"mx-2",icon:Se.faMagnifyingGlass}),e("Search")]})},_e=()=>{const{t:e}=D(),{data:n,status:i}=ne(),[t,c]=x.useState(T.DESCRIPTION);return a.jsxs("div",{className:"p-6",children:[a.jsx("h2",{className:"text-xl",children:a.jsx("strong",{children:e("Data")})}),a.jsxs("div",{className:"flex justify-between gap-2",children:[a.jsxs("div",{className:"flex gap-2 items-center",children:[a.jsx("div",{className:"text-sm",children:e("View")}),a.jsx(Ce,{defaultValue:t,onChange:s=>c(s)}),a.jsx(Ee,{})]}),a.jsx("div",{className:"flex items-center",children:a.jsx(ue,{})})]}),a.jsx(ie,{className:"my-4 border-t"}),i==="pending"?a.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-200px)]",children:a.jsx(Q,{})}):a.jsx("div",{className:"flex flex-col gap-4",children:n==null?void 0:n.map(s=>a.jsx(De,{isProcessing:s.in_progress||!1,dictionary:s,viewMode:t},s.name))})]})};export{_e as Data};
