import{u as w,r as m,a as ee,j as s,B as R,F as b,f as $,b as se,c as U,l as V,d as te,e as ae,R as ne,I as re,g as ie,h as le,i as ce,k as T,D as E,m as oe,n as de,o as ue,p as fe,q as L,s as he,S as me}from"./index-DSkPnGJe.js";import{C as W,f as xe,u as ge,L as X,a as ve,S as je}from"./loading-90-I1iuj.js";import{T as J,a as Y,b as O,c as k,d as Z,e as B,f as pe,g as Ne,h as be,i as q}from"./tabs-BabaHQce.js";const De=()=>{const{t:e}=w(),[a,c]=m.useState(!1),{mutate:i,isPending:t}=ee({onSuccess:()=>c(!1)}),r=()=>{c(!0)};return s.jsxs(s.Fragment,{children:[s.jsx(W,{open:a,isLoading:t,onOpenChange:c,title:e("Clear all datasets"),confirmText:e("Clear"),cancelText:e("Cancel"),description:e("Are you sure you want to clear all datasets?"),onConfirm:i,variant:"destructive"}),s.jsxs(R,{testId:"clear-datasets-button",variant:"ghost",onClick:r,children:[s.jsx(b,{icon:xe.faTrash}),e("Clear all datasets")]})]})},we=({onSearch:e,disabled:a=!1,placeholder:c,testId:i="search-control"})=>{const{t}=w(),r=c||t("Search"),[n,l]=m.useState(""),[o,h]=m.useState(!1),x=u=>{const d=u.target.value;l(d),e==null||e(d)},g=()=>{l(""),h(!1),e==null||e("")},f=()=>{a||h(!0)},v=()=>{n||h(!1)},j=u=>{u.key==="Escape"&&(l(""),h(!1),e==null||e(""))};return o?s.jsxs("div",{className:"mr-2 flex w-48 items-center transition-all duration-300 ease-in-out",children:[s.jsx(b,{icon:$,className:"mr-3 size-4 shrink-0 text-muted-foreground"}),s.jsxs("div",{className:"relative flex-1",children:[s.jsx("input",{type:"text",value:n,onChange:x,onBlur:v,onKeyDown:j,placeholder:r,autoFocus:!0,disabled:a,className:"h-9 w-full border-0 border-b border-border bg-transparent pr-8 text-sm transition-colors placeholder:font-medium placeholder:text-muted-foreground focus:border-primary focus:outline-none","data-testid":`${i}-input`}),n&&!a&&s.jsx(R,{variant:"ghost",size:"sm",onClick:g,onMouseDown:u=>u.preventDefault(),className:"absolute right-0 top-1/2 size-7 -translate-y-1/2 p-0 hover:bg-muted",title:t("Clear"),"data-testid":`${i}-clear`,children:s.jsx(b,{icon:se,className:"size-3"})})]})]}):s.jsxs(R,{variant:"ghost",size:"sm",onClick:f,disabled:a,className:"mr-2 h-9 px-3","aria-label":t("Search"),"data-testid":`${i}-button`,children:[s.jsx(b,{icon:$,className:"mr-2 size-4"}),s.jsx("span",{className:"text-sm",children:t("Search")})]})},Ce=({onSearch:e,onDownload:a,onDelete:c,isDownloading:i=!1,isProcessing:t=!1,className:r,disabled:n=!1})=>{const{t:l}=w(),o=n||t||i;return s.jsxs("div",{className:U("flex items-center gap-1",r),children:[e&&s.jsx(we,{onSearch:e,disabled:o}),a&&s.jsx(R,{variant:"link",onClick:a,title:l("Download dictionary as CSV"),disabled:o,children:i?s.jsx("img",{src:V,alt:l("downloading"),className:"w-4 h-4 animate-spin"}):s.jsx(b,{icon:te})}),c&&s.jsx(R,{variant:"link",onClick:c,title:l("Delete dictionary"),disabled:o,children:s.jsx(b,{icon:ae})})]})},Q=({initialValue:e,rowIndex:a,field:c,onUpdate:i})=>{const[t,r]=m.useState(!1),[n,l]=m.useState(e);ne.useEffect(()=>{l(e)},[e]);const o=()=>{r(!0)},h=()=>{r(!1),n!==e&&i&&i(a,c,n)},x=g=>{g.key==="Enter"?(g.preventDefault(),r(!1),n!==e&&i&&i(a,c,n)):g.key==="Escape"&&(r(!1),l(e))};return t?s.jsx(re,{value:n,onChange:g=>l(g.target.value),onBlur:h,onKeyDown:x,autoFocus:!0,className:"w-full h-[28px]"}):s.jsx("div",{onDoubleClick:o,className:"cursor-pointer hover:bg-secondary p-1 rounded min-h-[28px] text-muted-foreground",title:"Double-click to edit",children:n})},Te=({data:e,onUpdateCell:a})=>{var t;const{t:c}=w(),i=(r,n,l)=>{a&&a(r,n,l)};return s.jsxs(J,{children:[s.jsx(Y,{className:"bg-background",children:s.jsxs(O,{children:[s.jsx(k,{className:"w-[200px]",children:c("Column")}),s.jsx(k,{children:c("Type")}),s.jsx(k,{children:c("Description")})]})}),s.jsx(Z,{children:(t=e.column_descriptions)==null?void 0:t.map((r,n)=>s.jsxs(O,{children:[s.jsx(B,{className:"font-medium",children:r.column}),s.jsx(B,{children:s.jsx(Q,{initialValue:r.data_type,rowIndex:n,field:"data_type",onUpdate:i})}),s.jsx(B,{children:s.jsx(Q,{initialValue:r.description,rowIndex:n,field:"description",onUpdate:i})})]},r.column))})]})};var F=new Map,M=new WeakMap,K=0,ye=void 0;function Se(e){return e?(M.has(e)||(K+=1,M.set(e,K.toString())),M.get(e)):"0"}function Ee(e){return Object.keys(e).sort().filter(a=>e[a]!==void 0).map(a=>`${a}_${a==="root"?Se(e.root):e[a]}`).toString()}function Re(e){const a=Ee(e);let c=F.get(a);if(!c){const i=new Map;let t;const r=new IntersectionObserver(n=>{n.forEach(l=>{var o;const h=l.isIntersecting&&t.some(x=>l.intersectionRatio>=x);e.trackVisibility&&typeof l.isVisible>"u"&&(l.isVisible=h),(o=i.get(l.target))==null||o.forEach(x=>{x(h,l)})})},e);t=r.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),c={id:a,observer:r,elements:i},F.set(a,c)}return c}function Ie(e,a,c={},i=ye){if(typeof window.IntersectionObserver>"u"&&i!==void 0){const o=e.getBoundingClientRect();return a(i,{isIntersecting:i,target:e,intersectionRatio:typeof c.threshold=="number"?c.threshold:0,time:0,boundingClientRect:o,intersectionRect:o,rootBounds:o}),()=>{}}const{id:t,observer:r,elements:n}=Re(c),l=n.get(e)||[];return n.has(e)||n.set(e,l),l.push(a),r.observe(e),function(){l.splice(l.indexOf(a),1),l.length===0&&(n.delete(e),r.unobserve(e)),n.size===0&&(r.disconnect(),F.delete(t))}}function _e({threshold:e,delay:a,trackVisibility:c,rootMargin:i,root:t,triggerOnce:r,skip:n,initialInView:l,fallbackInView:o,onChange:h}={}){var x;const[g,f]=m.useState(null),v=m.useRef(h),[j,u]=m.useState({inView:!!l,entry:void 0});v.current=h,m.useEffect(()=>{if(n||!g)return;let D;return D=Ie(g,(y,C)=>{u({inView:y,entry:C}),v.current&&v.current(y,C),C.isIntersecting&&r&&D&&(D(),D=void 0)},{root:t,rootMargin:i,threshold:e,trackVisibility:c,delay:a},o),()=>{D&&D()}},[Array.isArray(e)?e.toString():e,g,t,i,r,n,c,o,a]);const d=(x=j.entry)==null?void 0:x.target,p=m.useRef(void 0);!g&&d&&!r&&!n&&p.current!==d&&(p.current=d,u({inView:!!l,entry:void 0}));const N=[f,j.inView,j.entry];return N.ref=N[0],N.inView=N[1],N.entry=N[2],N}const Le=({datasetName:e,rowsPerPage:a=50,searchText:c})=>{const{ref:i,inView:t}=_e(),{t:r}=w(),{data:n,fetchNextPage:l,hasNextPage:o,isFetchingNextPage:h,status:x,isError:g,error:f}=ge(e,a,c);m.useEffect(()=>{t&&o&&!h&&l()},[t,l,o,h]);const v=m.useMemo(()=>n?n.pages.flatMap(u=>u.dataset.data_records):[],[n]),j=m.useMemo(()=>{var u,d;return!n||!((d=(u=n.pages[0])==null?void 0:u.dataset)!=null&&d.data_records[0])?[]:Object.keys(n.pages[0].dataset.data_records[0])},[n]);return x==="pending"?s.jsx("div",{className:"h-96",children:s.jsx(X,{})}):g?s.jsxs("div",{className:"flex flex-col flex-1 items-center justify-center h-96",children:[r("Error loading data"),": ",String(f)]}):v.length===0?s.jsx("div",{className:"flex flex-col flex-1 items-center justify-center h-96",children:r("No data available for this dataset.")}):s.jsxs("div",{className:"w-full overflow-auto",children:[s.jsxs(J,{children:[s.jsx(Y,{className:"bg-background",children:s.jsx(O,{children:j.map(u=>s.jsx(k,{children:u},u))})}),s.jsx(Z,{children:v.map((u,d)=>s.jsx(O,{children:j.map(p=>s.jsx(B,{children:u[p]!==null&&u[p]!==void 0?String(u[p]):""},p))},d))})]}),s.jsx("div",{ref:i,className:"w-full text-center p-4",children:h?s.jsxs("div",{className:"flex justify-center items-center",children:[s.jsx("img",{src:V,alt:r("processing"),className:"mr-2 w-4 h-4 animate-spin"}),s.jsx("span",{className:"ml-2",children:r("Loading more...")})]}):o?s.jsx("div",{className:"h-10"}):s.jsx("div",{className:"text-muted-foreground",children:v.length>0?r("End of data"):r("No data available")})})]})},Me=["column","data_type","description"],ke=e=>{const[a,c]=m.useState(""),i=m.useMemo(()=>{var l;if(!a.trim())return e;const r=a.toLowerCase(),n=(l=e.column_descriptions)==null?void 0:l.filter(o=>Me.some(h=>{const x=o[h];return x&&x.toLowerCase().includes(r)}));return{...e,column_descriptions:n}},[e,a]);return{searchText:a,setSearchText:c,filteredDictionary:i,getOriginalRowIndex:r=>{var l;if(!a.trim()||!i.column_descriptions)return r;const n=i.column_descriptions[r];return n?((l=e.column_descriptions)==null?void 0:l.findIndex(o=>o.column===n.column))??r:r}}},Be=m.forwardRef(({dictionary:e,isProcessing:a=!0,viewMode:c="description"},i)=>{var y,C;const{t}=w(),[r,n]=m.useState(!1),{searchText:l,setSearchText:o,filteredDictionary:h,getOriginalRowIndex:x}=ke(e),{mutate:g,isPending:f}=ie({onSuccess:()=>{n(!1)}}),{mutate:v}=le(),{mutate:j,isPending:u}=ce(),{data:d,isLoading:p}=ve(e.name),N=S=>{if(S===0)return"0 Bytes";const I=1024,P=["Bytes","KB","MB","GB","TB"],_=Math.floor(Math.log(S)/Math.log(I));return parseFloat((S/Math.pow(I,_)).toFixed(2))+" "+P[_]},D=d!=null&&d.file_size?N(d.file_size):"0 MB";return s.jsxs("div",{ref:i,className:U("flex flex-col w-full bg-card p-4",{"h-[400px]":a}),children:[s.jsx(W,{open:r,onOpenChange:n,title:t("Delete dictionary"),confirmText:t("Delete"),cancelText:t("Cancel"),variant:"destructive",isLoading:f,description:t("Are you sure you want to delete this dictionary?"),onConfirm:()=>g({name:e.name})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg",children:s.jsx("strong",{children:e.name})}),s.jsxs("div",{className:"flex justify-between pt-1",children:[s.jsxs("div",{className:"flex gap-2 my-1",children:[s.jsx(T,{variant:"secondary",className:"leading-tight text-sm",children:p?t("Loading..."):`${((y=d==null?void 0:d.columns)==null?void 0:y.length)||0} ${t("features")}`}),s.jsx(T,{variant:"secondary",className:"leading-tight text-sm",children:p?t("Loading..."):`${((C=d==null?void 0:d.row_count)==null?void 0:C.toLocaleString())||0} ${t("rows")}`}),s.jsx(T,{variant:"secondary",className:"leading-tight text-sm",children:p?t("Loading..."):D}),s.jsx(T,{variant:"secondary",className:"leading-tight text-sm",children:(d==null?void 0:d.data_source)||t("file")}),a?s.jsxs(T,{variant:"outline",className:"leading-tight text-sm",children:[s.jsx("img",{src:V,alt:t("processing"),className:"mr-2 w-4 h-4 animate-spin"}),t("Processing...")]}):s.jsxs(T,{variant:"success",testId:"data-processed-badge",className:"leading-tight text-sm",children:[s.jsx(b,{className:"mr-1 w-4 h-4 ",icon:pe.faCheck}),t("Processed")]})]}),s.jsx(Ce,{onSearch:o,onDownload:()=>j({name:e.name}),onDelete:()=>n(!0),isDownloading:u,isProcessing:a})]})]}),s.jsx("div",{className:"flex flex-col flex-1 text-lg",children:a?s.jsx("div",{className:"flex flex-col flex-1 items-center justify-center",children:t("Processing the dataset may take a few minutes...")}):s.jsx(je,{className:"mt-4 h-96",children:c===E.DESCRIPTION?s.jsx(Te,{data:h,onUpdateCell:(S,I,P)=>{const _=x(S);v({name:e.name,rowIndex:_,field:I,value:P},{onError:()=>{}})}}):s.jsx(Le,{datasetName:e.name,rowsPerPage:50,searchText:l})})})]})});var z={},G;function Oe(){return G||(G=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var a="fas",c="quote-left",i=448,t=512,r=[8220,"quote-left-alt"],n="f10d",l="M0 216C0 149.7 53.7 96 120 96l8 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-8 0c-30.9 0-56 25.1-56 56l0 8 64 0c35.3 0 64 28.7 64 64l0 64c0 35.3-28.7 64-64 64l-64 0c-35.3 0-64-28.7-64-64l0-32 0-32 0-72zm256 0c0-66.3 53.7-120 120-120l8 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-8 0c-30.9 0-56 25.1-56 56l0 8 64 0c35.3 0 64 28.7 64 64l0 64c0 35.3-28.7 64-64 64l-64 0c-35.3 0-64-28.7-64-64l0-32 0-32 0-72z";e.definition={prefix:a,iconName:c,icon:[i,t,r,n,l]},e.faQuoteLeft=e.definition,e.prefix=a,e.iconName=c,e.width=i,e.height=t,e.ligatures=r,e.unicode=n,e.svgPathData=l,e.aliases=r}(z)),z}var Pe=Oe(),A={},H;function ze(){return H||(H=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var a="fas",c="table",i=512,t=512,r=[],n="f0ce",l="M64 256l0-96 160 0 0 96L64 256zm0 64l160 0 0 96L64 416l0-96zm224 96l0-96 160 0 0 96-160 0zM448 256l-160 0 0-96 160 0 0 96zM64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L64 32z";e.definition={prefix:a,iconName:c,icon:[i,t,r,n,l]},e.faTable=e.definition,e.prefix=a,e.iconName=c,e.width=i,e.height=t,e.ligatures=r,e.unicode=n,e.svgPathData=l,e.aliases=r}(A)),A}var Ae=ze();const Fe=({defaultValue:e=E.DESCRIPTION,onChange:a})=>{const{t:c}=w();return s.jsx(Ne,{defaultValue:e,onValueChange:a,className:"w-fit py-4",children:s.jsxs(be,{className:"grid w-full grid-cols-2",children:[s.jsxs(q,{value:E.DESCRIPTION,"data-testid":"description-tab",children:[s.jsx(b,{className:"mr-2",icon:Pe.faQuoteLeft}),c("Description")]}),s.jsxs(q,{value:E.RAW,"data-testid":"raw-tab",children:[s.jsx(b,{className:"mr-2",icon:Ae.faTable}),c("Raw rows")]})]})})},Qe=()=>{var g;const{t:e}=w(),a=oe(),c=de(),{dataId:i}=ue(),{data:t,status:r}=fe(),[n,l]=m.useState(E.DESCRIPTION),o=m.useRef({}),h=m.useRef(null);m.useEffect(()=>{var f;(f=c.state)!=null&&f.cancelScroll&&i&&a(L(i),{state:null,replace:!0})},[]),m.useEffect(()=>{(!i&&(t!=null&&t.length)||t!=null&&t.length&&!t.find(({name:f})=>i===f))&&a(L(t[0].name),{state:null,replace:!0}),i&&(t==null?void 0:t.length)===0&&a(L(),{state:null})},[i,t,a]),m.useEffect(()=>{var f,v;o.current&&i&&(t!=null&&t.length)&&!((f=c.state)!=null&&f.cancelScroll)&&((v=o.current[i])==null||v.scrollIntoView({behavior:"smooth"}))},[i,t,(g=c.state)==null?void 0:g.cancelScroll]);const x=he(()=>{var j;const f=((j=h.current)==null?void 0:j.getBoundingClientRect().top)||0,v=Object.keys(o.current);for(const u of v)if(o.current[u].getBoundingClientRect().top-f>=0){a(L(u),{state:{cancelScroll:!0}});break}},100);return s.jsxs("div",{className:"p-6 pr-0 flex flex-col h-full",children:[s.jsx("h2",{className:"text-xl",children:s.jsx("strong",{children:e("Data")})}),s.jsxs("div",{className:"flex justify-between gap-2",children:[s.jsxs("div",{className:"flex gap-2 items-center",children:[s.jsx("div",{className:"text-sm",children:e("View")}),s.jsx(Fe,{defaultValue:n,onChange:f=>l(f)})]}),s.jsx("div",{className:"flex items-center",children:!!(t!=null&&t.length)&&s.jsx(De,{})})]}),s.jsx(me,{className:"my-4 border-t"}),r==="pending"?s.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-200px)]",children:s.jsx(X,{})}):s.jsx("div",{ref:h,onScroll:x,className:"flex flex-1 flex-col gap-4 overflow-y-auto pr-6",children:t==null?void 0:t.map(f=>s.jsx(Be,{ref:v=>{v&&(o.current[f.name]=v)},isProcessing:f.in_progress||!1,dictionary:f,viewMode:n},f.name))})]})};export{Qe as Data};
