import{u as T,r as f,a as Z,j as a,B as z,F as w,R as ee,I as ae,l as k,b as se,c as te,d as ne,e as ie,f as C,D as S,g as re,h as le,i as ce,k as oe,m as de,n as M,o as ue,S as fe}from"./index-Dr41AYLo.js";import{C as H,f as W,u as he,L as U,a as ge,S as me}from"./loading-CEFhaZVm.js";import{T as J,a as X,b as P,c as E,d as Y,e as L,f as ve,g as xe,h as je,i as A}from"./tabs-DXqZvLd5.js";const Ne=()=>{const{t:e}=T(),[n,r]=f.useState(!1),{mutate:i,isPending:s}=Z({onSuccess:()=>r(!1)}),t=()=>{r(!0)};return a.jsxs(a.Fragment,{children:[a.jsx(H,{open:n,isLoading:s,onOpenChange:r,title:e("Clear all datasets"),confirmText:e("Clear"),cancelText:e("Cancel"),description:e("Are you sure you want to clear all datasets?"),onConfirm:i,variant:"destructive"}),a.jsxs(z,{testId:"clear-datasets-button",variant:"ghost",onClick:t,children:[a.jsx(w,{icon:W.faTrash}),e("Clear all datasets")]})]})};var I={},q;function De(){return q||(q=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var n="fas",r="download",i=512,s=512,t=[],l="f019",c="M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 242.7-73.4-73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l128-128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L288 274.7 288 32zM64 352c-35.3 0-64 28.7-64 64l0 32c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-32c0-35.3-28.7-64-64-64l-101.5 0-45.3 45.3c-25 25-65.5 25-90.5 0L165.5 352 64 352zm368 56a24 24 0 1 1 0 48 24 24 0 1 1 0-48z";e.definition={prefix:n,iconName:r,icon:[i,s,t,l,c]},e.faDownload=e.definition,e.prefix=n,e.iconName=r,e.width=i,e.height=s,e.ligatures=t,e.unicode=l,e.svgPathData=c,e.aliases=t}(I)),I}var we=De();const V=({initialValue:e,rowIndex:n,field:r,onUpdate:i})=>{const[s,t]=f.useState(!1),[l,c]=f.useState(e);ee.useEffect(()=>{c(e)},[e]);const d=()=>{t(!0)},m=()=>{t(!1),l!==e&&i&&i(n,r,l)},v=h=>{h.key==="Enter"?(h.preventDefault(),t(!1),l!==e&&i&&i(n,r,l)):h.key==="Escape"&&(t(!1),c(e))};return s?a.jsx(ae,{value:l,onChange:h=>c(h.target.value),onBlur:m,onKeyDown:v,autoFocus:!0,className:"w-full h-[28px]"}):a.jsx("div",{onDoubleClick:d,className:"cursor-pointer hover:bg-secondary p-1 rounded min-h-[28px]",title:"Double-click to edit",children:l})},be=({data:e,onUpdateCell:n})=>{var s;const{t:r}=T(),i=(t,l,c)=>{n&&n(t,l,c)};return a.jsxs(J,{children:[a.jsx(X,{className:"bg-background",children:a.jsxs(P,{children:[a.jsx(E,{className:"w-[200px]",children:r("Column")}),a.jsx(E,{children:r("Type")}),a.jsx(E,{children:r("Description")})]})}),a.jsx(Y,{children:(s=e.column_descriptions)==null?void 0:s.map((t,l)=>a.jsxs(P,{children:[a.jsx(L,{className:"font-medium",children:t.column}),a.jsx(L,{children:a.jsx(V,{initialValue:t.data_type,rowIndex:l,field:"data_type",onUpdate:i})}),a.jsx(L,{children:a.jsx(V,{initialValue:t.description,rowIndex:l,field:"description",onUpdate:i})})]},t.column))})]})};var F=new Map,R=new WeakMap,G=0,pe=void 0;function ye(e){return e?(R.has(e)||(G+=1,R.set(e,G.toString())),R.get(e)):"0"}function Ce(e){return Object.keys(e).sort().filter(n=>e[n]!==void 0).map(n=>`${n}_${n==="root"?ye(e.root):e[n]}`).toString()}function Te(e){const n=Ce(e);let r=F.get(n);if(!r){const i=new Map;let s;const t=new IntersectionObserver(l=>{l.forEach(c=>{var d;const m=c.isIntersecting&&s.some(v=>c.intersectionRatio>=v);e.trackVisibility&&typeof c.isVisible>"u"&&(c.isVisible=m),(d=i.get(c.target))==null||d.forEach(v=>{v(m,c)})})},e);s=t.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),r={id:n,observer:t,elements:i},F.set(n,r)}return r}function Se(e,n,r={},i=pe){if(typeof window.IntersectionObserver>"u"&&i!==void 0){const d=e.getBoundingClientRect();return n(i,{isIntersecting:i,target:e,intersectionRatio:typeof r.threshold=="number"?r.threshold:0,time:0,boundingClientRect:d,intersectionRect:d,rootBounds:d}),()=>{}}const{id:s,observer:t,elements:l}=Te(r),c=l.get(e)||[];return l.has(e)||l.set(e,c),c.push(n),t.observe(e),function(){c.splice(c.indexOf(n),1),c.length===0&&(l.delete(e),t.unobserve(e)),l.size===0&&(t.disconnect(),F.delete(s))}}function Me({threshold:e,delay:n,trackVisibility:r,rootMargin:i,root:s,triggerOnce:t,skip:l,initialInView:c,fallbackInView:d,onChange:m}={}){var v;const[h,o]=f.useState(null),g=f.useRef(m),[u,j]=f.useState({inView:!!c,entry:void 0});g.current=m,f.useEffect(()=>{if(l||!h)return;let D;return D=Se(h,(p,y)=>{j({inView:p,entry:y}),g.current&&g.current(p,y),y.isIntersecting&&t&&D&&(D(),D=void 0)},{root:s,rootMargin:i,threshold:e,trackVisibility:r,delay:n},d),()=>{D&&D()}},[Array.isArray(e)?e.toString():e,h,s,i,t,l,r,d,n]);const N=(v=u.entry)==null?void 0:v.target,b=f.useRef(void 0);!h&&N&&!t&&!l&&b.current!==N&&(b.current=N,j({inView:!!c,entry:void 0}));const x=[o,u.inView,u.entry];return x.ref=x[0],x.inView=x[1],x.entry=x[2],x}const Re=({datasetName:e,rowsPerPage:n=50})=>{const{ref:r,inView:i}=Me(),{t:s}=T(),{data:t,fetchNextPage:l,hasNextPage:c,isFetchingNextPage:d,status:m,isError:v,error:h}=he(e,n);f.useEffect(()=>{i&&c&&!d&&l()},[i,l,c,d]);const o=f.useMemo(()=>t?t.pages.flatMap(u=>u.dataset.data_records):[],[t]),g=f.useMemo(()=>{var u,j;return!t||!((j=(u=t.pages[0])==null?void 0:u.dataset)!=null&&j.data_records[0])?[]:Object.keys(t.pages[0].dataset.data_records[0])},[t]);return m==="pending"?a.jsx("div",{className:"h-96",children:a.jsx(U,{})}):v?a.jsxs("div",{className:"flex flex-col flex-1 items-center justify-center h-96",children:[s("Error loading data"),": ",String(h)]}):o.length===0?a.jsx("div",{className:"flex flex-col flex-1 items-center justify-center h-96",children:s("No data available for this dataset.")}):a.jsxs("div",{className:"w-full overflow-auto",children:[a.jsxs(J,{children:[a.jsx(X,{className:"bg-background",children:a.jsx(P,{children:g.map(u=>a.jsx(E,{children:u},u))})}),a.jsx(Y,{children:o.map((u,j)=>a.jsx(P,{children:g.map(N=>a.jsx(L,{children:u[N]!==null&&u[N]!==void 0?String(u[N]):""},N))},j))})]}),a.jsx("div",{ref:r,className:"w-full text-center p-4",children:d?a.jsxs("div",{className:"flex justify-center items-center",children:[a.jsx("img",{src:k,alt:s("processing"),className:"mr-2 w-4 h-4 animate-spin"}),a.jsx("span",{className:"ml-2",children:s("Loading more...")})]}):c?a.jsx("div",{className:"h-10"}):a.jsx("div",{className:"text-muted-foreground",children:o.length>0?s("End of data"):s("No data available")})})]})},Ee=f.forwardRef(({dictionary:e,isProcessing:n=!0,viewMode:r="description"},i)=>{var N,b;const{t:s}=T(),[t,l]=f.useState(!1),{mutate:c,isPending:d}=se({onSuccess:()=>{l(!1)}}),{mutate:m}=te(),{mutate:v,isPending:h}=ne(),{data:o,isLoading:g}=ge(e.name),u=x=>{if(x===0)return"0 Bytes";const D=1024,p=["Bytes","KB","MB","GB","TB"],y=Math.floor(Math.log(x)/Math.log(D));return parseFloat((x/Math.pow(D,y)).toFixed(2))+" "+p[y]},j=o!=null&&o.file_size?u(o.file_size):"0 MB";return a.jsxs("div",{ref:i,className:ie("flex flex-col w-full bg-card p-4",{"h-[400px]":n}),children:[a.jsx(H,{open:t,onOpenChange:l,title:s("Delete dictionary"),confirmText:s("Delete"),cancelText:s("Cancel"),variant:"destructive",isLoading:d,description:s("Are you sure you want to delete this dictionary?"),onConfirm:()=>c({name:e.name})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg",children:a.jsx("strong",{children:e.name})}),a.jsxs("div",{className:"flex justify-between pt-1",children:[a.jsxs("div",{className:"flex gap-2 my-1",children:[a.jsx(C,{variant:"secondary",className:"leading-tight text-sm",children:g?s("Loading..."):`${((N=o==null?void 0:o.columns)==null?void 0:N.length)||0} ${s("features")}`}),a.jsx(C,{variant:"secondary",className:"leading-tight text-sm",children:g?s("Loading..."):`${((b=o==null?void 0:o.row_count)==null?void 0:b.toLocaleString())||0} ${s("rows")}`}),a.jsx(C,{variant:"secondary",className:"leading-tight text-sm",children:g?s("Loading..."):j}),a.jsx(C,{variant:"secondary",className:"leading-tight text-sm",children:(o==null?void 0:o.data_source)||s("file")}),n?a.jsxs(C,{variant:"outline",className:"leading-tight text-sm",children:[a.jsx("img",{src:k,alt:s("processing"),className:"mr-2 w-4 h-4 animate-spin"}),s("Processing...")]}):a.jsxs(C,{variant:"success",testId:"data-processed-badge",className:"leading-tight text-sm",children:[a.jsx(w,{className:"mr-2 w-4 h-4 ",icon:ve.faCheck}),s("Processed")]})]}),a.jsxs("div",{className:"flex gap-2 px-2",children:[a.jsx(z,{variant:"link",onClick:()=>{v({name:e.name})},title:s("Download dictionary as CSV"),disabled:n||h,children:h?a.jsx("img",{src:k,alt:s("downloading"),className:"w-4 h-4 animate-spin"}):a.jsx(w,{icon:we.faDownload})}),a.jsx(z,{variant:"link",onClick:()=>{l(!0)},title:s("Delete dictionary"),children:a.jsx(w,{icon:W.faTrash})})]})]})]}),a.jsx("div",{className:"flex flex-col flex-1 text-lg",children:n?a.jsx("div",{className:"flex flex-col flex-1 items-center justify-center",children:s("Processing the dataset may take a few minutes...")}):a.jsx(me,{className:"mt-4 h-96",children:r===S.DESCRIPTION?a.jsx(be,{data:e,onUpdateCell:(x,D,p)=>{m({name:e.name,rowIndex:x,field:D,value:p},{onError:()=>{}})}}):a.jsx(Re,{datasetName:e.name,rowsPerPage:50})})})]})});var _={},$;function Le(){return $||($=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var n="fas",r="quote-left",i=448,s=512,t=[8220,"quote-left-alt"],l="f10d",c="M0 216C0 149.7 53.7 96 120 96l8 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-8 0c-30.9 0-56 25.1-56 56l0 8 64 0c35.3 0 64 28.7 64 64l0 64c0 35.3-28.7 64-64 64l-64 0c-35.3 0-64-28.7-64-64l0-32 0-32 0-72zm256 0c0-66.3 53.7-120 120-120l8 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-8 0c-30.9 0-56 25.1-56 56l0 8 64 0c35.3 0 64 28.7 64 64l0 64c0 35.3-28.7 64-64 64l-64 0c-35.3 0-64-28.7-64-64l0-32 0-32 0-72z";e.definition={prefix:n,iconName:r,icon:[i,s,t,l,c]},e.faQuoteLeft=e.definition,e.prefix=n,e.iconName=r,e.width=i,e.height=s,e.ligatures=t,e.unicode=l,e.svgPathData=c,e.aliases=t}(_)),_}var Pe=Le(),B={},Q;function Ie(){return Q||(Q=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var n="fas",r="table",i=512,s=512,t=[],l="f0ce",c="M64 256l0-96 160 0 0 96L64 256zm0 64l160 0 0 96L64 416l0-96zm224 96l0-96 160 0 0 96-160 0zM448 256l-160 0 0-96 160 0 0 96zM64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L64 32z";e.definition={prefix:n,iconName:r,icon:[i,s,t,l,c]},e.faTable=e.definition,e.prefix=n,e.iconName=r,e.width=i,e.height=s,e.ligatures=t,e.unicode=l,e.svgPathData=c,e.aliases=t}(B)),B}var _e=Ie();const Be=({defaultValue:e=S.DESCRIPTION,onChange:n})=>{const{t:r}=T();return a.jsx(xe,{defaultValue:e,onValueChange:n,className:"w-fit py-4",children:a.jsxs(je,{className:"grid w-full grid-cols-2",children:[a.jsxs(A,{value:S.DESCRIPTION,"data-testid":"description-tab",children:[a.jsx(w,{className:"mr-2",icon:Pe.faQuoteLeft}),r("Description")]}),a.jsxs(A,{value:S.RAW,"data-testid":"raw-tab",children:[a.jsx(w,{className:"mr-2",icon:_e.faTable}),r("Raw rows")]})]})})};var O={},K;function Oe(){return K||(K=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var n="fas",r="magnifying-glass",i=512,s=512,t=[128269,"search"],l="f002",c="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z";e.definition={prefix:n,iconName:r,icon:[i,s,t,l,c]},e.faMagnifyingGlass=e.definition,e.prefix=n,e.iconName=r,e.width=i,e.height=s,e.ligatures=t,e.unicode=l,e.svgPathData=c,e.aliases=t}(O)),O}var ze=Oe();const ke=()=>{const{t:e}=re();return a.jsxs("div",{children:[a.jsx(w,{className:"mx-2",icon:ze.faMagnifyingGlass}),e("Search")]})},Ve=()=>{var h;const{t:e}=T(),n=le(),r=ce(),{dataId:i}=oe(),{data:s,status:t}=de(),[l,c]=f.useState(S.DESCRIPTION),d=f.useRef({}),m=f.useRef(null);f.useEffect(()=>{var o;(o=r.state)!=null&&o.cancelScroll&&i&&n(M(i),{state:null,replace:!0})},[]),f.useEffect(()=>{(!i&&(s!=null&&s.length)||s!=null&&s.length&&!s.find(({name:o})=>i===o))&&n(M(s[0].name),{state:null,replace:!0}),i&&(s==null?void 0:s.length)===0&&n(M(),{state:null})},[i,s,n]),f.useEffect(()=>{var o,g;d.current&&i&&(s!=null&&s.length)&&!((o=r.state)!=null&&o.cancelScroll)&&((g=d.current[i])==null||g.scrollIntoView({behavior:"smooth"}))},[i,s,(h=r.state)==null?void 0:h.cancelScroll]);const v=ue(()=>{var u;const o=((u=m.current)==null?void 0:u.getBoundingClientRect().top)||0,g=Object.keys(d.current);for(const j of g)if(d.current[j].getBoundingClientRect().top-o>=0){n(M(j),{state:{cancelScroll:!0}});break}},100);return a.jsxs("div",{className:"p-6 pr-0 flex flex-col h-full",children:[a.jsx("h2",{className:"text-xl",children:a.jsx("strong",{children:e("Data")})}),a.jsxs("div",{className:"flex justify-between gap-2",children:[a.jsxs("div",{className:"flex gap-2 items-center",children:[a.jsx("div",{className:"text-sm",children:e("View")}),a.jsx(Be,{defaultValue:l,onChange:o=>c(o)}),a.jsx(ke,{})]}),a.jsx("div",{className:"flex items-center",children:!!(s!=null&&s.length)&&a.jsx(Ne,{})})]}),a.jsx(fe,{className:"my-4 border-t"}),t==="pending"?a.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-200px)]",children:a.jsx(U,{})}):a.jsx("div",{ref:m,onScroll:v,className:"flex flex-1 flex-col gap-4 overflow-y-auto pr-6",children:s==null?void 0:s.map(o=>a.jsx(Ee,{ref:g=>{g&&(d.current[o.name]=g)},isProcessing:o.in_progress||!1,dictionary:o,viewMode:l},o.name))})]})};export{Ve as Data};
