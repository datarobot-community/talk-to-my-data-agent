import{u as w,r as h,a as se,j as s,B as E,F as b,f as q,b as te,c as W,l as V,d as ae,e as ne,R as re,I as ie,g as le,h as ce,i as oe,k as de,m as T,D as S,n as ue,o as fe,p as he,q as me,s as L,t as xe,S as ge}from"./index-DnsQ3JLc.js";import{C as X,f as ve,u as je,L as J,a as pe,S as Ne}from"./loading-Dl0zvYh-.js";import{T as Y,a as Z,b as O,c as B,d as ee,e as k,f as be,g as De,h as we,i as Q}from"./tabs-DD0yVPep.js";const Ce=()=>{const{t:e}=w(),[a,c]=h.useState(!1),{mutate:i,isPending:t}=se({onSuccess:()=>c(!1)}),r=()=>{c(!0)};return s.jsxs(s.Fragment,{children:[s.jsx(X,{open:a,isLoading:t,onOpenChange:c,title:e("Clear all datasets"),confirmText:e("Clear"),cancelText:e("Cancel"),description:e("Are you sure you want to clear all datasets?"),onConfirm:i,variant:"destructive"}),s.jsxs(E,{testId:"clear-datasets-button",variant:"ghost",onClick:r,children:[s.jsx(b,{icon:ve.faTrash}),e("Clear all datasets")]})]})},Te=({onSearch:e,disabled:a=!1,placeholder:c,testId:i="search-control"})=>{const{t}=w(),r=c||t("Search"),[n,l]=h.useState(""),[o,f]=h.useState(!1),x=d=>{const j=d.target.value;l(j),e==null||e(j)},g=()=>{l(""),f(!1),e==null||e("")},u=()=>{a||f(!0)},v=()=>{n||f(!1)},p=d=>{d.key==="Escape"&&(l(""),f(!1),e==null||e(""))};return o?s.jsxs("div",{className:"mr-2 flex w-48 items-center transition-all duration-300 ease-in-out",children:[s.jsx(b,{icon:q,className:"mr-3 size-4 shrink-0 text-muted-foreground"}),s.jsxs("div",{className:"relative flex-1",children:[s.jsx("input",{type:"text",value:n,onChange:x,onBlur:v,onKeyDown:p,placeholder:r,autoFocus:!0,disabled:a,className:"h-9 w-full border-0 border-b border-border bg-transparent pr-8 text-sm transition-colors placeholder:font-medium placeholder:text-muted-foreground focus:border-primary focus:outline-none","data-testid":`${i}-input`}),n&&!a&&s.jsx(E,{variant:"ghost",size:"sm",onClick:g,onMouseDown:d=>d.preventDefault(),className:"absolute right-0 top-1/2 size-7 -translate-y-1/2 p-0 hover:bg-muted",title:t("Clear"),"data-testid":`${i}-clear`,children:s.jsx(b,{icon:te,className:"size-3"})})]})]}):s.jsxs(E,{variant:"ghost",size:"sm",onClick:u,disabled:a,className:"mr-2 h-9 px-3","aria-label":t("Search"),"data-testid":`${i}-button`,children:[s.jsx(b,{icon:q,className:"mr-2 size-4"}),s.jsx("span",{className:"text-sm",children:t("Search")})]})},ye=({onSearch:e,onDownload:a,onDelete:c,isDownloading:i=!1,isProcessing:t=!1,className:r,disabled:n=!1})=>{const{t:l}=w(),o=n||t||i;return s.jsxs("div",{className:W("flex items-center gap-1",r),children:[e&&s.jsx(Te,{onSearch:e,disabled:o}),a&&s.jsx(E,{variant:"link",onClick:a,title:l("Download dictionary as CSV"),disabled:o,children:i?s.jsx("img",{src:V,alt:l("downloading"),className:"w-4 h-4 animate-spin"}):s.jsx(b,{icon:ae})}),c&&s.jsx(E,{variant:"link",onClick:c,title:l("Delete dictionary"),disabled:o,children:s.jsx(b,{icon:ne})})]})},K=({initialValue:e,rowIndex:a,field:c,onUpdate:i})=>{const[t,r]=h.useState(!1),[n,l]=h.useState(e);re.useEffect(()=>{l(e)},[e]);const o=()=>{r(!0)},f=()=>{r(!1),n!==e&&i&&i(a,c,n)},x=g=>{g.key==="Enter"?(g.preventDefault(),r(!1),n!==e&&i&&i(a,c,n)):g.key==="Escape"&&(r(!1),l(e))};return t?s.jsx(ie,{value:n,onChange:g=>l(g.target.value),onBlur:f,onKeyDown:x,autoFocus:!0,className:"w-full h-[28px]"}):s.jsx("div",{onDoubleClick:o,className:"cursor-pointer hover:bg-secondary p-1 rounded min-h-[28px] text-muted-foreground",title:"Double-click to edit",children:n})},Se=({data:e,onUpdateCell:a})=>{var t;const{t:c}=w(),i=(r,n,l)=>{a&&a(r,n,l)};return s.jsxs(Y,{children:[s.jsx(Z,{className:"bg-background",children:s.jsxs(O,{children:[s.jsx(B,{className:"w-[200px]",children:c("Column")}),s.jsx(B,{children:c("Type")}),s.jsx(B,{children:c("Description")})]})}),s.jsx(ee,{children:(t=e.column_descriptions)==null?void 0:t.map((r,n)=>s.jsxs(O,{children:[s.jsx(k,{className:"font-medium",children:r.column}),s.jsx(k,{children:s.jsx(K,{initialValue:r.data_type,rowIndex:n,field:"data_type",onUpdate:i})}),s.jsx(k,{children:s.jsx(K,{initialValue:r.description,rowIndex:n,field:"description",onUpdate:i})})]},r.column))})]})};var F=new Map,M=new WeakMap,G=0,Ee=void 0;function Re(e){return e?(M.has(e)||(G+=1,M.set(e,G.toString())),M.get(e)):"0"}function Ie(e){return Object.keys(e).sort().filter(a=>e[a]!==void 0).map(a=>`${a}_${a==="root"?Re(e.root):e[a]}`).toString()}function _e(e){const a=Ie(e);let c=F.get(a);if(!c){const i=new Map;let t;const r=new IntersectionObserver(n=>{n.forEach(l=>{var o;const f=l.isIntersecting&&t.some(x=>l.intersectionRatio>=x);e.trackVisibility&&typeof l.isVisible>"u"&&(l.isVisible=f),(o=i.get(l.target))==null||o.forEach(x=>{x(f,l)})})},e);t=r.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),c={id:a,observer:r,elements:i},F.set(a,c)}return c}function Le(e,a,c={},i=Ee){if(typeof window.IntersectionObserver>"u"&&i!==void 0){const o=e.getBoundingClientRect();return a(i,{isIntersecting:i,target:e,intersectionRatio:typeof c.threshold=="number"?c.threshold:0,time:0,boundingClientRect:o,intersectionRect:o,rootBounds:o}),()=>{}}const{id:t,observer:r,elements:n}=_e(c),l=n.get(e)||[];return n.has(e)||n.set(e,l),l.push(a),r.observe(e),function(){l.splice(l.indexOf(a),1),l.length===0&&(n.delete(e),r.unobserve(e)),n.size===0&&(r.disconnect(),F.delete(t))}}function Me({threshold:e,delay:a,trackVisibility:c,rootMargin:i,root:t,triggerOnce:r,skip:n,initialInView:l,fallbackInView:o,onChange:f}={}){var x;const[g,u]=h.useState(null),v=h.useRef(f),[p,d]=h.useState({inView:!!l,entry:void 0});v.current=f,h.useEffect(()=>{if(n||!g)return;let D;return D=Le(g,(R,C)=>{d({inView:R,entry:C}),v.current&&v.current(R,C),C.isIntersecting&&r&&D&&(D(),D=void 0)},{root:t,rootMargin:i,threshold:e,trackVisibility:c,delay:a},o),()=>{D&&D()}},[Array.isArray(e)?e.toString():e,g,t,i,r,n,c,o,a]);const j=(x=p.entry)==null?void 0:x.target,m=h.useRef(void 0);!g&&j&&!r&&!n&&m.current!==j&&(m.current=j,d({inView:!!l,entry:void 0}));const N=[u,p.inView,p.entry];return N.ref=N[0],N.inView=N[1],N.entry=N[2],N}const Be=({datasetName:e,rowsPerPage:a=50,searchText:c})=>{const{ref:i,inView:t}=Me(),{t:r}=w(),{data:n,fetchNextPage:l,hasNextPage:o,isFetchingNextPage:f,status:x,isError:g,error:u}=je(e,a,c);h.useEffect(()=>{t&&o&&!f&&l()},[t,l,o,f]);const v=h.useMemo(()=>n?n.pages.flatMap(d=>d.dataset.data_records):[],[n]),p=h.useMemo(()=>{var d,j;return!n||!((j=(d=n.pages[0])==null?void 0:d.dataset)!=null&&j.data_records[0])?[]:Object.keys(n.pages[0].dataset.data_records[0])},[n]);return x==="pending"?s.jsx("div",{className:"h-96",children:s.jsx(J,{})}):g?s.jsxs("div",{className:"flex flex-col flex-1 items-center justify-center h-96",children:[r("Error loading data"),": ",String(u)]}):v.length===0?s.jsx("div",{className:"flex flex-col flex-1 items-center justify-center h-96",children:r("No data available for this dataset.")}):s.jsxs("div",{className:"w-full overflow-auto",children:[s.jsxs(Y,{children:[s.jsx(Z,{className:"bg-background",children:s.jsx(O,{children:p.map(d=>s.jsx(B,{children:d},d))})}),s.jsx(ee,{children:v.map((d,j)=>s.jsx(O,{children:p.map(m=>s.jsx(k,{children:d[m]!==null&&d[m]!==void 0?String(d[m]):""},m))},j))})]}),s.jsx("div",{ref:i,className:"w-full text-center p-4",children:f?s.jsxs("div",{className:"flex justify-center items-center",children:[s.jsx("img",{src:V,alt:r("processing"),className:"mr-2 w-4 h-4 animate-spin"}),s.jsx("span",{className:"ml-2",children:r("Loading more...")})]}):o?s.jsx("div",{className:"h-10"}):s.jsx("div",{className:"text-muted-foreground",children:v.length>0?r("End of data"):r("No data available")})})]})},ke=["column","data_type","description"],Oe=e=>{const[a,c]=h.useState(""),i=h.useMemo(()=>{var l;if(!a.trim())return e;const r=a.toLowerCase(),n=(l=e.column_descriptions)==null?void 0:l.filter(o=>ke.some(f=>{const x=o[f];return x&&x.toLowerCase().includes(r)}));return{...e,column_descriptions:n}},[e,a]);return{searchText:a,setSearchText:c,filteredDictionary:i,getOriginalRowIndex:r=>{var l;if(!a.trim()||!i.column_descriptions)return r;const n=i.column_descriptions[r];return n?((l=e.column_descriptions)==null?void 0:l.findIndex(o=>o.column===n.column))??r:r}}},Pe=h.forwardRef(({dictionary:e,isProcessing:a=!0,viewMode:c="description"},i)=>{var C,$;const{t}=w(),[r,n]=h.useState(!1),{searchText:l,setSearchText:o,filteredDictionary:f,getOriginalRowIndex:x}=Oe(e),{mutate:g,isPending:u}=le({onSuccess:()=>{n(!1)}}),{mutate:v}=ce(),{mutate:p,isPending:d}=oe(),{includeCsvBom:j}=de(),{data:m,isLoading:N}=pe(e.name),D=y=>{if(y===0)return"0 Bytes";const I=1024,P=["Bytes","KB","MB","GB","TB"],_=Math.floor(Math.log(y)/Math.log(I));return parseFloat((y/Math.pow(I,_)).toFixed(2))+" "+P[_]},R=m!=null&&m.file_size?D(m.file_size):"0 MB";return s.jsxs("div",{ref:i,className:W("flex flex-col w-full bg-card p-4",{"h-[400px]":a}),children:[s.jsx(X,{open:r,onOpenChange:n,title:t("Delete dictionary"),confirmText:t("Delete"),cancelText:t("Cancel"),variant:"destructive",isLoading:u,description:t("Are you sure you want to delete this dictionary?"),onConfirm:()=>g({name:e.name})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg",children:s.jsx("strong",{children:e.name})}),s.jsxs("div",{className:"flex justify-between pt-1",children:[s.jsxs("div",{className:"flex gap-2 my-1",children:[s.jsx(T,{variant:"secondary",className:"leading-tight text-sm",children:N?t("Loading..."):`${((C=m==null?void 0:m.columns)==null?void 0:C.length)||0} ${t("features")}`}),s.jsx(T,{variant:"secondary",className:"leading-tight text-sm",children:N?t("Loading..."):`${(($=m==null?void 0:m.row_count)==null?void 0:$.toLocaleString())||0} ${t("rows")}`}),s.jsx(T,{variant:"secondary",className:"leading-tight text-sm",children:N?t("Loading..."):R}),s.jsx(T,{variant:"secondary",className:"leading-tight text-sm",children:(m==null?void 0:m.data_source)||t("file")}),a?s.jsxs(T,{variant:"outline",className:"leading-tight text-sm",children:[s.jsx("img",{src:V,alt:t("processing"),className:"mr-2 w-4 h-4 animate-spin"}),t("Processing...")]}):s.jsxs(T,{variant:"success",testId:"data-processed-badge",className:"leading-tight text-sm",children:[s.jsx(b,{className:"mr-1 w-4 h-4 ",icon:be.faCheck}),t("Processed")]})]}),s.jsx(ye,{onSearch:o,onDownload:()=>p({name:e.name,includeBom:j}),onDelete:()=>n(!0),isDownloading:d,isProcessing:a})]})]}),s.jsx("div",{className:"flex flex-col flex-1 text-lg",children:a?s.jsx("div",{className:"flex flex-col flex-1 items-center justify-center",children:t("Processing the dataset may take a few minutes...")}):s.jsx(Ne,{className:"mt-4 h-96",children:c===S.DESCRIPTION?s.jsx(Se,{data:f,onUpdateCell:(y,I,P)=>{const _=x(y);v({name:e.name,rowIndex:_,field:I,value:P},{onError:()=>{}})}}):s.jsx(Be,{datasetName:e.name,rowsPerPage:50,searchText:l})})})]})});var z={},H;function ze(){return H||(H=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var a="fas",c="quote-left",i=448,t=512,r=[8220,"quote-left-alt"],n="f10d",l="M0 216C0 149.7 53.7 96 120 96l8 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-8 0c-30.9 0-56 25.1-56 56l0 8 64 0c35.3 0 64 28.7 64 64l0 64c0 35.3-28.7 64-64 64l-64 0c-35.3 0-64-28.7-64-64l0-32 0-32 0-72zm256 0c0-66.3 53.7-120 120-120l8 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-8 0c-30.9 0-56 25.1-56 56l0 8 64 0c35.3 0 64 28.7 64 64l0 64c0 35.3-28.7 64-64 64l-64 0c-35.3 0-64-28.7-64-64l0-32 0-32 0-72z";e.definition={prefix:a,iconName:c,icon:[i,t,r,n,l]},e.faQuoteLeft=e.definition,e.prefix=a,e.iconName=c,e.width=i,e.height=t,e.ligatures=r,e.unicode=n,e.svgPathData=l,e.aliases=r}(z)),z}var Ae=ze(),A={},U;function Fe(){return U||(U=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var a="fas",c="table",i=512,t=512,r=[],n="f0ce",l="M64 256l0-96 160 0 0 96L64 256zm0 64l160 0 0 96L64 416l0-96zm224 96l0-96 160 0 0 96-160 0zM448 256l-160 0 0-96 160 0 0 96zM64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L64 32z";e.definition={prefix:a,iconName:c,icon:[i,t,r,n,l]},e.faTable=e.definition,e.prefix=a,e.iconName=c,e.width=i,e.height=t,e.ligatures=r,e.unicode=n,e.svgPathData=l,e.aliases=r}(A)),A}var Ve=Fe();const $e=({defaultValue:e=S.DESCRIPTION,onChange:a})=>{const{t:c}=w();return s.jsx(De,{defaultValue:e,onValueChange:a,className:"w-fit py-4",children:s.jsxs(we,{className:"grid w-full grid-cols-2",children:[s.jsxs(Q,{value:S.DESCRIPTION,"data-testid":"description-tab",children:[s.jsx(b,{className:"mr-2",icon:Ae.faQuoteLeft}),c("Description")]}),s.jsxs(Q,{value:S.RAW,"data-testid":"raw-tab",children:[s.jsx(b,{className:"mr-2",icon:Ve.faTable}),c("Raw rows")]})]})})},Ge=()=>{var g;const{t:e}=w(),a=ue(),c=fe(),{dataId:i}=he(),{data:t,status:r}=me(),[n,l]=h.useState(S.DESCRIPTION),o=h.useRef({}),f=h.useRef(null);h.useEffect(()=>{var u;(u=c.state)!=null&&u.cancelScroll&&i&&a(L(i),{state:null,replace:!0})},[]),h.useEffect(()=>{(!i&&(t!=null&&t.length)||t!=null&&t.length&&!t.find(({name:u})=>i===u))&&a(L(t[0].name),{state:null,replace:!0}),i&&(t==null?void 0:t.length)===0&&a(L(),{state:null})},[i,t,a]),h.useEffect(()=>{var u,v;o.current&&i&&(t!=null&&t.length)&&!((u=c.state)!=null&&u.cancelScroll)&&((v=o.current[i])==null||v.scrollIntoView({behavior:"smooth"}))},[i,t,(g=c.state)==null?void 0:g.cancelScroll]);const x=xe(()=>{var p;const u=((p=f.current)==null?void 0:p.getBoundingClientRect().top)||0,v=Object.keys(o.current);for(const d of v)if(o.current[d].getBoundingClientRect().top-u>=0){a(L(d),{state:{cancelScroll:!0}});break}},100);return s.jsxs("div",{className:"p-6 pr-0 flex flex-col h-full",children:[s.jsx("h2",{className:"text-xl",children:s.jsx("strong",{children:e("Data")})}),s.jsxs("div",{className:"flex justify-between gap-2",children:[s.jsxs("div",{className:"flex gap-2 items-center",children:[s.jsx("div",{className:"text-sm",children:e("View")}),s.jsx($e,{defaultValue:n,onChange:u=>l(u)})]}),s.jsx("div",{className:"flex items-center",children:!!(t!=null&&t.length)&&s.jsx(Ce,{})})]}),s.jsx(ge,{className:"my-4 border-t"}),r==="pending"?s.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-200px)]",children:s.jsx(J,{})}):s.jsx("div",{ref:f,onScroll:x,className:"flex flex-1 flex-col gap-4 overflow-y-auto pr-6",children:t==null?void 0:t.map(u=>s.jsx(Pe,{ref:v=>{v&&(o.current[u.name]=v)},isProcessing:u.in_progress||!1,dictionary:u,viewMode:n},u.name))})]})};export{Ge as Data};
