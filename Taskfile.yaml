---
# File generated by DataRobot CLI, regenerate using `dr task compose`
version: '3'
env:
  ENV: testing
dotenv: ['.env', '.env.{{.ENV}}']
includes:
  app_backend:
    taskfile: ./app_backend/Taskfile.yaml
    dir: ./app_backend
  app_frontend:
    taskfile: ./app_frontend/Taskfile.yaml
    dir: ./app_frontend
  core:
    taskfile: ./core/Taskfile.yaml
    dir: ./core
  infra:
    taskfile: ./infra/Taskfile.yaml
    dir: ./infra
tasks:
  default:
    desc: "â„¹ï¸ Show all available tasks (run `task --list-all` to see hidden tasks)"
    cmds:
      - task --list --sort none
    silent: true

  start:
    desc: "ğŸ’» Prepare local development environment"
    cmds:
      - dr self update
      - dr dotenv setup --if-needed
      - task install
      - task infra:start
      - echo 'âœ… You are all set. Run `task dev` to start developing, or run `task deploy-dev` to deploy to DataRobot.'

  lint:
    desc: "ğŸ§¹ Run linters"
    cmds:
      - task: app_backend:lint
      - task: app_frontend:lint
      - task: core:lint
      - task: infra:lint

  install:
    desc: "ğŸ› ï¸ Install all dependencies"
    cmds:
      - task: app_backend:install
      - task: app_frontend:install
      - task: core:install
      - task: infra:install

  reinstall:
    desc: "ğŸ› ï¸ Reinstall all dependencies (placeholder task)"

  test:
    desc: "ğŸ§ª Run tests across all components"
    cmds:
      - task: app_backend:test
      - task: app_frontend:test
      - task: core:test
  dev:
    desc: "ğŸš€ Run all services together"
    cmds:
      - |
        task app_backend:dev &
        sleep 3
        task app_frontend:dev &
        sleep 8
        echo "âœ… All servers started!"
        if [[ -n "$NOTEBOOK_ID" ]]; then
          prefix="${DATAROBOT_API_ENDPOINT//api\/v2/}notebook-sessions/$NOTEBOOK_ID/ports/"
        else
          prefix="http://localhost:"
        fi
        echo "ğŸ”— Backend: ${prefix}8080"
        echo "ğŸ”— Frontend: ${prefix}5173"
        wait
  deploy:
    desc: "ğŸš€ Deploy all services"
    env:
      AGENT_DEPLOY: "1"
    cmds:
      - task: infra:deploy
  deploy-dev:
    desc: "ğŸš€ Deploy infrastructure and services to development"
    cmds:
      - task: infra:deploy-dev
