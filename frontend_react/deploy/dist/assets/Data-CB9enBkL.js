import{Q as Y,i as B,h as Z,a as ee,u as ae,b as se,j as a,B as _,F as N,c as V,d as te,r as v,R as ne,I as ie,l as I,e as re,f as ce,g as le,k as oe,m as p,D as y,n as de,o as ue,S as fe}from"./index-BG6VKLZA.js";import{f as $,L as K,S as he}from"./loading-COMgdw54.js";import{T as U,a as W,b as C,c as P,d as H,e as M,f as ge,g as me,h as ve,i as O}from"./tabs-Dx-WVMm1.js";var xe=class extends Y{constructor(e,s){super(e,s)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e){super.setOptions({...e,behavior:B()})}getOptimisticResult(e){return e.behavior=B(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,s){var f,m;const{state:i}=e,r=super.createResult(e,s),{isFetching:t,isRefetching:c,isError:l,isRefetchError:n}=r,o=(m=(f=i.fetchMeta)==null?void 0:f.fetchMore)==null?void 0:m.direction,g=l&&o==="forward",h=t&&o==="forward",u=l&&o==="backward",x=t&&o==="backward";return{...r,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:ee(s,i.data),hasPreviousPage:Z(s,i.data),isFetchNextPageError:g,isFetchingNextPage:h,isFetchPreviousPageError:u,isFetchingPreviousPage:x,isRefetchError:n&&!g&&!u,isRefetching:c&&!h&&!x}}};function je(e,s){return ae(e,xe)}const Ne=({onClear:e})=>{const{mutate:s}=se(),i=()=>{s(),e&&e()};return a.jsxs(_,{variant:"ghost",onClick:i,children:[a.jsx(N,{icon:$.faTrash}),"Clear all datasets"]})},J={all:["cleansed_datasets"],detail:e=>[...J.all,e]},X={all:["dataset_metadata"],detail:e=>[...X.all,e]},we=async({name:e,skip:s=0,limit:i=100,signal:r})=>{const t=encodeURIComponent(e),{data:c}=await V.get(`/v1/datasets/${t}/cleansed?skip=${s}&limit=${i}`,{signal:r});return c},be=async({name:e,signal:s})=>{const i=encodeURIComponent(e),{data:r}=await V.get(`/v1/datasets/${i}/metadata`,{signal:s});return r},pe=(e,s=100)=>je({queryKey:J.detail(e),initialPageParam:0,queryFn:({pageParam:i=0,signal:r})=>we({name:e,skip:i,limit:s,signal:r}),getNextPageParam:(i,r)=>{const t=r.length*s;if(!(i.dataset.data_records.length<s))return t},staleTime:5*60*1e3}),ye=e=>te({queryKey:X.detail(e),queryFn:({signal:s})=>be({name:e,signal:s}),staleTime:5*60*1e3,refetchOnWindowFocus:!1});var T={},z;function De(){return z||(z=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var s="fas",i="download",r=512,t=512,c=[],l="f019",n="M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 242.7-73.4-73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l128-128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L288 274.7 288 32zM64 352c-35.3 0-64 28.7-64 64l0 32c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-32c0-35.3-28.7-64-64-64l-101.5 0-45.3 45.3c-25 25-65.5 25-90.5 0L165.5 352 64 352zm368 56a24 24 0 1 1 0 48 24 24 0 1 1 0-48z";e.definition={prefix:s,iconName:i,icon:[r,t,c,l,n]},e.faDownload=e.definition,e.prefix=s,e.iconName=i,e.width=r,e.height=t,e.ligatures=c,e.unicode=l,e.svgPathData=n,e.aliases=c}(T)),T}var Pe=De();const Q=({initialValue:e,rowIndex:s,field:i,onUpdate:r})=>{const[t,c]=v.useState(!1),[l,n]=v.useState(e);ne.useEffect(()=>{n(e)},[e]);const o=()=>{c(!0)},g=()=>{c(!1),l!==e&&r&&r(s,i,l)},h=u=>{u.key==="Enter"?(u.preventDefault(),c(!1),l!==e&&r&&r(s,i,l)):u.key==="Escape"&&(c(!1),n(e))};return t?a.jsx(ie,{value:l,onChange:u=>n(u.target.value),onBlur:g,onKeyDown:h,autoFocus:!0,className:"w-full h-[28px]"}):a.jsx("div",{onDoubleClick:o,className:"cursor-pointer hover:bg-secondary p-1 rounded min-h-[28px]",title:"Double-click to edit",children:l})},Me=({data:e,onUpdateCell:s})=>{var r;const i=(t,c,l)=>{s&&s(t,c,l)};return a.jsxs(U,{children:[a.jsx(W,{className:"bg-background",children:a.jsxs(C,{children:[a.jsx(P,{className:"w-[200px]",children:"Column"}),a.jsx(P,{children:"Type"}),a.jsx(P,{children:"Description"})]})}),a.jsx(H,{children:(r=e.column_descriptions)==null?void 0:r.map((t,c)=>a.jsxs(C,{children:[a.jsx(M,{className:"font-medium",children:t.column}),a.jsx(M,{children:a.jsx(Q,{initialValue:t.data_type,rowIndex:c,field:"data_type",onUpdate:i})}),a.jsx(M,{children:a.jsx(Q,{initialValue:t.description,rowIndex:c,field:"description",onUpdate:i})})]},t.column))})]})};var F=new Map,D=new WeakMap,q=0,Ce=void 0;function Re(e){return e?(D.has(e)||(q+=1,D.set(e,q.toString())),D.get(e)):"0"}function Te(e){return Object.keys(e).sort().filter(s=>e[s]!==void 0).map(s=>`${s}_${s==="root"?Re(e.root):e[s]}`).toString()}function Ee(e){const s=Te(e);let i=F.get(s);if(!i){const r=new Map;let t;const c=new IntersectionObserver(l=>{l.forEach(n=>{var o;const g=n.isIntersecting&&t.some(h=>n.intersectionRatio>=h);e.trackVisibility&&typeof n.isVisible>"u"&&(n.isVisible=g),(o=r.get(n.target))==null||o.forEach(h=>{h(g,n)})})},e);t=c.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),i={id:s,observer:c,elements:r},F.set(s,i)}return i}function Se(e,s,i={},r=Ce){if(typeof window.IntersectionObserver>"u"&&r!==void 0){const o=e.getBoundingClientRect();return s(r,{isIntersecting:r,target:e,intersectionRatio:typeof i.threshold=="number"?i.threshold:0,time:0,boundingClientRect:o,intersectionRect:o,rootBounds:o}),()=>{}}const{id:t,observer:c,elements:l}=Ee(i),n=l.get(e)||[];return l.has(e)||l.set(e,n),n.push(s),c.observe(e),function(){n.splice(n.indexOf(s),1),n.length===0&&(l.delete(e),c.unobserve(e)),l.size===0&&(c.disconnect(),F.delete(t))}}function _e({threshold:e,delay:s,trackVisibility:i,rootMargin:r,root:t,triggerOnce:c,skip:l,initialInView:n,fallbackInView:o,onChange:g}={}){var h;const[u,x]=v.useState(null),d=v.useRef(g),[f,m]=v.useState({inView:!!n,entry:void 0});d.current=g,v.useEffect(()=>{if(l||!u)return;let b;return b=Se(u,(k,R)=>{m({inView:k,entry:R}),d.current&&d.current(k,R),R.isIntersecting&&c&&b&&(b(),b=void 0)},{root:t,rootMargin:r,threshold:e,trackVisibility:i,delay:s},o),()=>{b&&b()}},[Array.isArray(e)?e.toString():e,u,t,r,c,l,i,o,s]);const w=(h=f.entry)==null?void 0:h.target,L=v.useRef(void 0);!u&&w&&!c&&!l&&L.current!==w&&(L.current=w,m({inView:!!n,entry:void 0}));const j=[x,f.inView,f.entry];return j.ref=j[0],j.inView=j[1],j.entry=j[2],j}const Ie=({datasetName:e,rowsPerPage:s=50})=>{const{ref:i,inView:r}=_e(),{data:t,fetchNextPage:c,hasNextPage:l,isFetchingNextPage:n,status:o,isError:g,error:h}=pe(e,s);v.useEffect(()=>{r&&l&&!n&&c()},[r,c,l,n]);const u=v.useMemo(()=>t?t.pages.flatMap(d=>d.dataset.data_records):[],[t]),x=v.useMemo(()=>{var d,f;return!t||!((f=(d=t.pages[0])==null?void 0:d.dataset)!=null&&f.data_records[0])?[]:Object.keys(t.pages[0].dataset.data_records[0])},[t]);return o==="pending"?a.jsx("div",{className:"h-96",children:a.jsx(K,{})}):g?a.jsxs("div",{className:"flex flex-col flex-1 items-center justify-center h-96",children:["Error loading data: ",String(h)]}):u.length===0?a.jsx("div",{className:"flex flex-col flex-1 items-center justify-center h-96",children:"No data available for this dataset."}):a.jsxs("div",{className:"w-full overflow-auto",children:[a.jsxs(U,{children:[a.jsx(W,{className:"bg-background",children:a.jsx(C,{children:x.map(d=>a.jsx(P,{children:d},d))})}),a.jsx(H,{children:u.map((d,f)=>a.jsx(C,{children:x.map(m=>a.jsx(M,{children:d[m]!==null&&d[m]!==void 0?String(d[m]):""},m))},f))})]}),a.jsx("div",{ref:i,className:"w-full text-center p-4",children:n?a.jsxs("div",{className:"flex justify-center items-center",children:[a.jsx("img",{src:I,alt:"processing",className:"mr-2 w-4 h-4 animate-spin"}),a.jsx("span",{className:"ml-2",children:"Loading more..."})]}):l?a.jsx("div",{className:"h-10"}):a.jsx("div",{className:"text-muted-foreground",children:u.length>0?"End of data":"No data available"})})]})},Fe=({dictionary:e,isProcessing:s=!0,viewMode:i="description"})=>{var u,x;const{mutate:r}=re(),{mutate:t}=ce(),{mutate:c,isPending:l}=le(),{data:n,isLoading:o}=ye(e.name),g=d=>{if(d===0)return"0 Bytes";const f=1024,m=["Bytes","KB","MB","GB","TB"],w=Math.floor(Math.log(d)/Math.log(f));return parseFloat((d/Math.pow(f,w)).toFixed(2))+" "+m[w]},h=n!=null&&n.file_size?g(n.file_size):"0 MB";return a.jsxs("div",{className:oe("flex flex-col w-full bg-card p-4",{"h-[400px]":s}),children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg",children:a.jsx("strong",{children:e.name})}),a.jsxs("div",{className:"flex justify-between pt-1",children:[a.jsxs("div",{className:"flex gap-2 my-1",children:[a.jsx(p,{variant:"secondary",className:"leading-tight text-sm",children:o?"Loading...":`${((u=n==null?void 0:n.columns)==null?void 0:u.length)||0} features`}),a.jsx(p,{variant:"secondary",className:"leading-tight text-sm",children:o?"Loading...":`${((x=n==null?void 0:n.row_count)==null?void 0:x.toLocaleString())||0} rows`}),a.jsx(p,{variant:"secondary",className:"leading-tight text-sm",children:o?"Loading...":h}),a.jsx(p,{variant:"secondary",className:"leading-tight text-sm",children:(n==null?void 0:n.data_source)||"file"}),s?a.jsxs(p,{variant:"outline",className:"leading-tight text-sm",children:[a.jsx("img",{src:I,alt:"processing",className:"mr-2 w-4 h-4 animate-spin"}),"Processing..."]}):a.jsxs(p,{variant:"success",className:"leading-tight text-sm",children:[a.jsx(N,{className:"mr-2 w-4 h-4 ",icon:ge.faCheck}),"Processed"]})]}),a.jsxs("div",{className:"flex gap-2 px-2",children:[a.jsx(_,{variant:"link",onClick:()=>{c({name:e.name})},title:"Download dictionary as CSV",disabled:s||l,children:l?a.jsx("img",{src:I,alt:"downloading",className:"w-4 h-4 animate-spin"}):a.jsx(N,{icon:Pe.faDownload})}),a.jsx(_,{variant:"link",onClick:()=>{r({name:e.name})},title:"Delete dictionary",children:a.jsx(N,{icon:$.faTrash})})]})]})]}),a.jsx("div",{className:"flex flex-col flex-1 text-lg",children:s?a.jsx("div",{className:"flex flex-col flex-1 items-center justify-center",children:"Processing the dataset may take a few minutes..."}):a.jsx(he,{className:"mt-4 h-96",children:i===y.DESCRIPTION?a.jsx(Me,{data:e,onUpdateCell:(d,f,m)=>{t({name:e.name,rowIndex:d,field:f,value:m},{onError:()=>{}})}}):a.jsx(Ie,{datasetName:e.name,rowsPerPage:50})})})]})};var E={},A;function Le(){return A||(A=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var s="fas",i="quote-left",r=448,t=512,c=[8220,"quote-left-alt"],l="f10d",n="M0 216C0 149.7 53.7 96 120 96l8 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-8 0c-30.9 0-56 25.1-56 56l0 8 64 0c35.3 0 64 28.7 64 64l0 64c0 35.3-28.7 64-64 64l-64 0c-35.3 0-64-28.7-64-64l0-32 0-32 0-72zm256 0c0-66.3 53.7-120 120-120l8 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-8 0c-30.9 0-56 25.1-56 56l0 8 64 0c35.3 0 64 28.7 64 64l0 64c0 35.3-28.7 64-64 64l-64 0c-35.3 0-64-28.7-64-64l0-32 0-32 0-72z";e.definition={prefix:s,iconName:i,icon:[r,t,c,l,n]},e.faQuoteLeft=e.definition,e.prefix=s,e.iconName=i,e.width=r,e.height=t,e.ligatures=c,e.unicode=l,e.svgPathData=n,e.aliases=c}(E)),E}var ke=Le();const Be=({defaultValue:e=y.DESCRIPTION,onChange:s})=>a.jsx(me,{defaultValue:e,onValueChange:s,className:"w-fit py-4",children:a.jsxs(ve,{className:"grid w-full grid-cols-2",children:[a.jsxs(O,{value:y.DESCRIPTION,children:[a.jsx(N,{className:"mr-2",icon:ke.faQuoteLeft}),"Description"]}),a.jsxs(O,{value:y.RAW,children:[a.jsx(N,{className:"mr-2",icon:de.faTable}),"Raw rows"]})]})});var S={},G;function Oe(){return G||(G=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var s="fas",i="magnifying-glass",r=512,t=512,c=[128269,"search"],l="f002",n="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z";e.definition={prefix:s,iconName:i,icon:[r,t,c,l,n]},e.faMagnifyingGlass=e.definition,e.prefix=s,e.iconName=i,e.width=r,e.height=t,e.ligatures=c,e.unicode=l,e.svgPathData=n,e.aliases=c}(S)),S}var ze=Oe();const Qe=()=>a.jsxs("div",{children:[a.jsx(N,{className:"mx-2",icon:ze.faMagnifyingGlass}),"Search"]}),Ve=()=>{const{data:e,status:s}=ue(),[i,r]=v.useState(y.DESCRIPTION);return a.jsxs("div",{className:"p-6",children:[a.jsx("h2",{className:"text-xl",children:a.jsx("strong",{children:"Data"})}),a.jsxs("div",{className:"flex justify-between gap-2",children:[a.jsxs("div",{className:"flex gap-2 items-center",children:[a.jsx("div",{className:"text-sm",children:"View"}),a.jsx(Be,{defaultValue:i,onChange:t=>r(t)}),a.jsx(Qe,{})]}),a.jsx("div",{className:"flex items-center",children:a.jsx(Ne,{})})]}),a.jsx(fe,{className:"my-4 border-t"}),s==="pending"?a.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-200px)]",children:a.jsx(K,{})}):a.jsx("div",{className:"flex flex-col gap-4",children:e==null?void 0:e.map(t=>a.jsx(Fe,{isProcessing:t.in_progress||!1,dictionary:t,viewMode:i},t.name))})]})};export{Ve as Data};
