const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./react-plotly-D2MY7B9e.js","./index-BFBsHk4D.js","./index-B_kYS3PG.css","./ResponseMessage-CFrQ6qOS.js","./tabs-B3ArC2pK.js","./loading-Lg5OiBnJ.js"])))=>i.map(i=>d[i]);
import{j as t,i as se,k as ne,F as N,r as u,m as R,n as re,o as _e,P as _,p as ie,q as ye,s as Me,t as we,v as I,R as C,e as L,w as S,x as oe,a as H,y as x,B as M,_ as le,z as Te,A as Ae,C as Ee,E as Re,G as Ie,H as Se,J as De,K as ke,L as Fe,I as Ge,M as Ve,N as ce,O as Oe,Q as ze,T as He,U as Be,V as de,W as Ze,X as Ue,Y as qe,h as $e,S as J}from"./index-BFBsHk4D.js";import{f as ue,b as Ke,L as Je,S as Ye}from"./loading-Lg5OiBnJ.js";var k={},Y;function Qe(){return Y||(Y=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var a="far",s="comment",n=512,i=512,r=[128489,61669],o="f075",l="M123.6 391.3c12.9-9.4 29.6-11.8 44.6-6.4c26.5 9.6 56.2 15.1 87.8 15.1c124.7 0 208-80.5 208-160s-83.3-160-208-160S48 160.5 48 240c0 32 12.4 62.8 35.7 89.2c8.6 9.7 12.8 22.5 11.8 35.5c-1.4 18.1-5.7 34.7-11.3 49.4c17-7.9 31.1-16.7 39.4-22.7zM21.2 431.9c1.8-2.7 3.5-5.4 5.1-8.1c10-16.6 19.5-38.4 21.4-62.9C17.7 326.8 0 285.1 0 240C0 125.1 114.6 32 256 32s256 93.1 256 208s-114.6 208-256 208c-37.1 0-72.3-6.4-104.1-17.9c-11.9 8.7-31.3 20.6-54.3 30.6c-15.1 6.6-32.3 12.6-50.1 16.1c-.8 .2-1.6 .3-2.4 .5c-4.4 .8-8.7 1.5-13.2 1.9c-.2 0-.5 .1-.7 .1c-5.1 .5-10.2 .8-15.3 .8c-6.5 0-12.3-3.9-14.8-9.9c-2.5-6-1.1-12.8 3.4-17.4c4.1-4.2 7.8-8.7 11.3-13.5c1.7-2.3 3.3-4.6 4.8-6.9l.3-.5z";e.definition={prefix:a,iconName:s,icon:[n,i,r,o,l]},e.faComment=e.definition,e.prefix=a,e.iconName=s,e.width=n,e.height=i,e.ligatures=r,e.unicode=o,e.svgPathData=l,e.aliases=r}(k)),k}var We=Qe();const Xe="data:image/svg+xml,%3csvg%20width='25'%20height='24'%20viewBox='0%200%2025%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20%3e%3crect%20x='0.682129'%20width='24'%20height='24'%20rx='12'%20fill='%2373FF95'%20/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M5.93506%205.49414H12.6824V6.93975H5.93506V5.49414ZM16.052%206.93994H12.6783V8.38555H16.052V6.93994ZM5.93506%208.38573H12.6824V9.83134H5.93506V8.38573ZM19.4293%209.83294H16.0556V11.2773H5.93506V12.7229H16.056V11.2786H19.4293V9.83294ZM19.4293%2012.7231H16.0556V14.1687H19.4293V12.7231ZM5.93506%2014.1689H12.6824V15.6145H5.93506V14.1689ZM16.052%2015.6147H12.6783V17.0603H16.052V15.6147ZM12.6824%2017.0605H5.93506V18.5061H12.6824V17.0605Z'%20fill='%23181D21'%20/%3e%3c/svg%3e",Ot=()=>{const e=se();return t.jsx("div",{className:"text-center text-sm font-normal leading-tight text-primary-foreground",children:t.jsx("img",{src:Xe,alt:"",className:"cursor-pointer",onClick:()=>e(ne.DATA)})})},et=()=>t.jsx("div",{className:"w-6 h-6 p-2.5 bg-[#7c97f8] rounded-[100px] flex-col justify-center items-center gap-2.5 inline-flex overflow-hidden",children:t.jsx("div",{className:"text-center text-sm font-normal leading-tight text-primary-foreground",children:t.jsx(N,{icon:We.faComment})})});var F={},Q;function tt(){return Q||(Q=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var a="fas",s="chevron-up",n=512,i=512,r=[],o="f077",l="M233.4 105.4c12.5-12.5 32.8-12.5 45.3 0l192 192c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L256 173.3 86.6 342.6c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l192-192z";e.definition={prefix:a,iconName:s,icon:[n,i,r,o,l]},e.faChevronUp=e.definition,e.prefix=a,e.iconName=s,e.width=n,e.height=i,e.ligatures=r,e.unicode=o,e.svgPathData=l,e.aliases=r}(F)),F}var at=tt(),G={},W;function st(){return W||(W=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var a="fas",s="chevron-down",n=512,i=512,r=[],o="f078",l="M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z";e.definition={prefix:a,iconName:s,icon:[n,i,r,o,l]},e.faChevronDown=e.definition,e.prefix=a,e.iconName=s,e.width=n,e.height=i,e.ligatures=r,e.unicode=o,e.svgPathData=l,e.aliases=r}(G)),G}var nt=st(),B="Collapsible",[rt,zt]=re(B),[it,Z]=rt(B),fe=u.forwardRef((e,a)=>{const{__scopeCollapsible:s,open:n,defaultOpen:i,disabled:r,onOpenChange:o,...l}=e,[d=!1,f]=R({prop:n,defaultProp:i,onChange:o});return t.jsx(it,{scope:s,disabled:r,contentId:_e(),open:d,onOpenToggle:u.useCallback(()=>f(m=>!m),[f]),children:t.jsx(_.div,{"data-state":q(d),"data-disabled":r?"":void 0,...l,ref:a})})});fe.displayName=B;var pe="CollapsibleTrigger",ge=u.forwardRef((e,a)=>{const{__scopeCollapsible:s,...n}=e,i=Z(pe,s);return t.jsx(_.button,{type:"button","aria-controls":i.contentId,"aria-expanded":i.open||!1,"data-state":q(i.open),"data-disabled":i.disabled?"":void 0,disabled:i.disabled,...n,ref:a,onClick:ie(e.onClick,i.onOpenToggle)})});ge.displayName=pe;var U="CollapsibleContent",he=u.forwardRef((e,a)=>{const{forceMount:s,...n}=e,i=Z(U,e.__scopeCollapsible);return t.jsx(ye,{present:s||i.open,children:({present:r})=>t.jsx(ot,{...n,ref:a,present:r})})});he.displayName=U;var ot=u.forwardRef((e,a)=>{const{__scopeCollapsible:s,present:n,children:i,...r}=e,o=Z(U,s),[l,d]=u.useState(n),f=u.useRef(null),m=Me(a,f),p=u.useRef(0),c=p.current,b=u.useRef(0),g=b.current,P=o.open||l,T=u.useRef(P),v=u.useRef(void 0);return u.useEffect(()=>{const h=requestAnimationFrame(()=>T.current=!1);return()=>cancelAnimationFrame(h)},[]),we(()=>{const h=f.current;if(h){v.current=v.current||{transitionDuration:h.style.transitionDuration,animationName:h.style.animationName},h.style.transitionDuration="0s",h.style.animationName="none";const j=h.getBoundingClientRect();p.current=j.height,b.current=j.width,T.current||(h.style.transitionDuration=v.current.transitionDuration,h.style.animationName=v.current.animationName),d(n)}},[o.open,n]),t.jsx(_.div,{"data-state":q(o.open),"data-disabled":o.disabled?"":void 0,id:o.contentId,hidden:!P,...r,ref:m,style:{"--radix-collapsible-content-height":c?`${c}px`:void 0,"--radix-collapsible-content-width":g?`${g}px`:void 0,...e.style},children:P&&i})});function q(e){return e?"open":"closed"}var lt=fe;function ct({...e}){return t.jsx(lt,{"data-slot":"collapsible",...e})}function dt({...e}){return t.jsx(ge,{"data-slot":"collapsible-trigger",...e})}function ut({...e}){return t.jsx(he,{"data-slot":"collapsible-content",...e})}const ft=({header:e,children:a,defaultOpen:s})=>{const{collapsiblePanelDefaultOpen:n}=I(),[i,r]=C.useState(s!==void 0?s:n),o=u.useRef(null);return t.jsxs(ct,{open:i,onOpenChange:r,className:"rounded border border-border",children:[t.jsx(dt,{asChild:!0,className:"bg-muted",children:t.jsxs("div",{className:"h-[52px] flex justify-between items-center px-4 cursor-pointer",children:[t.jsx("div",{children:e}),t.jsx(N,{icon:i?at.faChevronUp:nt.faChevronDown})]})}),t.jsx(ut,{ref:o,className:"py-4 px-4 bg-muted",children:a})]})},$=u.forwardRef(({className:e,type:a,icon:s,onKeyDown:n,iconProps:{behavior:i,...r},...o},l)=>{const d=s,[f,m]=u.useState(!1),[p,c]=u.useState(!1);return t.jsxs("div",{className:L("border-input file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground aria-invalid:outline-destructive/60 aria-invalid:ring-destructive/20 dark:aria-invalid:outline-destructive dark:aria-invalid:ring-destructive/50 ring-ring/10 dark:ring-ring/20 dark:outline-ring/40 outline-ring/50 aria-invalid:border-destructive/60 dark:aria-invalid:border-destructive h-9 w-full rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium min-w-[600px] min-h-[57px] justify-start items-center inline-flex",f&&"ring-4 outline-1 disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50",e),children:[d&&i==="prepend"&&t.jsx("div",{className:L("w-4 h-4 mr-3 text-muted-foreground"),children:t.jsx(d,{...r})}),t.jsx("input",{type:a,className:L("flex items-center justify-center w-full bg-transparent placeholder:text-muted-foreground file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50",e),onCompositionStart:()=>c(!0),onCompositionEnd:()=>c(!1),onKeyDown:b=>{n&&!p&&n(b)},onFocus:()=>m(!0),onBlur:()=>m(!1),ref:l,...o}),d&&i==="append"&&t.jsx("div",{className:L("w-4 ml-3 text-muted-foreground h-9 flex-col justify-center items-center inline-flex cursor-pointer"),children:t.jsx(d,{...r})})]})});$.displayName="PromptInput";var V={},X;function pt(){return X||(X=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var a="fas",s="paper-plane",n=512,i=512,r=[61913],o="f1d8",l="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480l0-83.6c0-4 1.5-7.8 4.2-10.8L331.8 202.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8 17.7 316.6C7.1 311.3 .3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4z";e.definition={prefix:a,iconName:s,icon:[n,i,r,o,l]},e.faPaperPlane=e.definition,e.prefix=a,e.iconName=s,e.width=n,e.height=i,e.ligatures=r,e.unicode=o,e.svgPathData=l,e.aliases=r}(V)),V}var me=pt();const gt="data:image/svg+xml,%3csvg%20width='200'%20height='200'%20viewBox='0%200%20200%20200'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M16%20136V128L100%2080L184%20128V136L100%20184L16%20136Z'%20fill='%231D2226'/%3e%3cpath%20d='M16%20128V136L100%20184M16%20128L100%20176M16%20128L100%2080L184%20128M184%20128V136L100%20184M184%20128L100%20176M100%20176V184'%20stroke='%233E454D'%20stroke-width='0.5'/%3e%3cpath%20d='M69.7677%2089.5558C65.1232%2092.2373%2061.358%2098.7587%2061.358%20104.122V139.898C61.358%20145.261%2065.1232%20147.434%2069.7677%20144.753L109.564%20121.776C113.697%20124.463%20122.887%20124.241%20130.551%20121.287C132.038%20120.714%20133.499%20120.047%20134.915%20119.306C129.545%20120.349%20125.042%20117.697%20124.384%20113.22L133.504%20107.955C138.148%20105.273%20141.914%2098.7519%20141.914%2093.3889V57.6129C141.914%2052.2499%20138.148%2050.0762%20133.504%2052.7576L69.7677%2089.5558Z'%20fill='%233E454D'%20stroke='%23111519'%20stroke-width='0.5'/%3e%3cpath%20d='M70.457%20101.309L70.457%2098.6077L132.034%2063.3482L132.034%2069.1356L70.457%20105.055L70.457%20101.309Z'%20fill='%232A3036'/%3e%3cpath%20d='M70.457%20111.572L70.457%20108.871L132.034%2073.611L132.034%2079.3984L70.457%20115.318L70.457%20111.572Z'%20fill='%232A3036'/%3e%3cpath%20d='M70.457%20121.835L70.457%20119.133L132.034%2083.8737L132.034%2089.6612L70.457%20125.581L70.457%20121.835Z'%20fill='%232A3036'/%3e%3cpath%20d='M70.457%20132.097L70.457%20129.396L118.564%20101.192L118.564%20106.979L70.457%20135.843L70.457%20132.097Z'%20fill='%232A3036'/%3e%3cpath%20d='M61.5408%20141.815C61.421%20141.232%2061.358%20140.591%2061.358%20139.898V104.122C61.358%2098.7587%2065.1232%2092.2374%2069.7677%2089.5558L133.504%2052.7577C135.147%2051.8088%20136.681%2051.4679%20137.976%2051.6612C134.9%2049.4301%20130.778%2049.6702%20128.363%2051.0645L65.4096%2087.3768C60.7651%2090.0583%2057%2096.5797%2057%20101.943V137.719C57%20140.4%2059.179%20144.217%2063.8893%20145.718C62.6782%20145.019%2061.8347%20143.683%2061.5408%20141.815Z'%20fill='%232A3036'%20stroke='%23111519'%20stroke-width='0.5'/%3e%3cpath%20d='M157%2057.0565L148.736%2058.2967L147.966%2056.3392L145.677%2050.5195L142.619%2061.828L142.139%2062.3104L134.355%2070.1306L140.483%2069.2109L142.619%2068.8904L145.677%2076.6677L148.662%2065.6322L148.736%2065.3592L157%2057.0565Z'%20fill='%2342C0FC'%20stroke='%231D2226'%20stroke-width='0.5'/%3e%3c/svg%3e",ht=({chatId:e,allowedDataSources:a})=>{const{enableChartGeneration:s,enableBusinessInsights:n,dataSource:i}=I(),{data:r}=S(),{mutate:o}=oe(),[l,d]=u.useState(""),f=!(a!=null&&a[0]),{t:m}=H(),p=e?r==null?void 0:r.find(g=>g.id===e):void 0,c=u.useMemo(()=>{const g=(p==null?void 0:p.data_source)||i;return a!=null&&a.includes(g)?g:(a==null?void 0:a[0])||x.FILE},[p==null?void 0:p.data_source,i,a]),b=()=>{l.trim()&&(o({message:l,chatId:e,enableChartGeneration:s,enableBusinessInsights:n,dataSource:c}),d(""))};return t.jsx("div",{className:"flex-1 flex flex-col p-4",children:t.jsx("div",{className:"flex flex-col flex-1 items-center justify-center",children:t.jsxs("div",{className:"w-[400px] flex flex-col flex-1 items-center justify-center",children:[t.jsx("img",{src:gt,alt:""}),t.jsx("h4",{className:"mb-2 mt-4",children:t.jsx("strong",{className:" text-center font-semibold",children:m("prompt_title")})}),t.jsx("p",{className:"text-center mb-10",children:m("prompt_description")}),t.jsx($,{icon:N,iconProps:{icon:f?null:me.faPaperPlane,behavior:"append",onClick:b},disabled:f,"aria-disabled":f,onChange:g=>d(g.target.value),onKeyDown:g=>{g.key==="Enter"&&b()},value:l,placeholder:m(f?"prompt_placeholder_disabled":"prompt_placeholder_enabled")})]})})})},Ht=C.memo(({children:e})=>t.jsx("div",{className:"p-3 bg-card rounded flex-col justify-start items-start gap-3 flex mb-2.5 mr-2",children:e})),mt=({avatar:e=et,name:a,date:s,onDelete:n})=>t.jsxs("div",{className:"self-stretch justify-between items-center gap-1 inline-flex",children:[t.jsxs("div",{className:"grow shrink basis-0 h-6 justify-start items-center gap-2 flex",children:[e(),t.jsx("div",{className:"text-sm font-semibold leading-tight",children:a}),t.jsx("div",{className:"text-xs font-normal leading-[17px]",children:s})]}),n&&t.jsx(M,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:i=>{i.stopPropagation(),n()},title:"Delete message",children:t.jsx(N,{icon:ue.faTrash,className:"h-3.5 w-3.5"})})]}),vt=u.lazy(()=>le(()=>import("./react-plotly-D2MY7B9e.js").then(e=>e.r),__vite__mapDeps([0,1,2]),import.meta.url)),xt=()=>t.jsx("div",{className:"flex items-center justify-center p-4 h-[200px]",children:t.jsx("div",{children:"Loading visualization..."})}),Bt=({plotData:e,className:a="",width:s="100%",height:n="500px"})=>!e||!e.data||!e.layout?null:t.jsx(ft,{header:void 0,defaultOpen:!0,children:t.jsx(u.Suspense,{fallback:t.jsx(xt,{}),children:t.jsx(vt,{data:e.data,layout:e.layout,className:a,style:{position:"relative",width:s,height:n},config:{responsive:!0,scrollZoom:!1,displayModeBar:!1,displaylogo:!1}})})}),Zt=e=>{if(!e)return null;try{return{paper_bgcolor:"rgba(255,255,255, 0)",...JSON.parse(e)}}catch(a){return console.error("Failed to parse plot data:",a),null}},bt=e=>{if(!e)return"";try{return new Date(e).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch(a){return console.error("Error formatting date:",a),""}},jt=({id:e,date:a,timestamp:s,message:n,chatId:i,responseId:r})=>{const o=u.useRef(null),{mutate:l}=Te(),d=s?bt(s):a||"",f=()=>{e&&l({messageId:e,chatId:i}),r&&l({messageId:r,chatId:i})};return t.jsxs("div",{className:"p-3 bg-card rounded flex-col justify-start items-start gap-3 flex mb-2.5 mr-2",ref:o,children:[t.jsx(mt,{name:"You",date:d,onDelete:f}),t.jsx("div",{className:"self-stretch text-sm font-normal leading-tight",children:n})]})},Ct=({chatId:e,allowSend:a,allowedDataSources:s})=>{const{mutate:n}=oe(),{enableChartGeneration:i,enableBusinessInsights:r,dataSource:o}=I(),{data:l}=S(),d=!(s!=null&&s[0]),[f,m]=u.useState(""),p=e?l==null?void 0:l.find(g=>g.id===e):void 0,c=u.useMemo(()=>{const g=(p==null?void 0:p.data_source)||o;return s!=null&&s.includes(g)?g:(s==null?void 0:s[0])||x.FILE},[p==null?void 0:p.data_source,o,s]),b=()=>{f.trim()&&(n({message:f,chatId:e,enableChartGeneration:i,enableBusinessInsights:r,dataSource:c}),m(""))};return t.jsx($,{icon:N,iconProps:{icon:d?null:me.faPaperPlane,behavior:"append",onClick:b},placeholder:d?"Please upload and process data using the sidebar before starting the chat":"Ask another question about your datasets.",onKeyDown:g=>{g.key==="Enter"&&a&&b()},disabled:d,"aria-disabled":d,onChange:g=>m(g.target.value),value:f})};var O={},ee;function Pt(){return ee||(ee=1,function(e){Object.defineProperty(e,"__esModule",{value:!0});var a="fas",s="pencil",n=512,i=512,r=[9999,61504,"pencil-alt"],o="f303",l="M410.3 231l11.3-11.3-33.9-33.9-62.1-62.1L291.7 89.8l-11.3 11.3-22.6 22.6L58.6 322.9c-10.4 10.4-18 23.3-22.2 37.4L1 480.7c-2.5 8.4-.2 17.5 6.1 23.7s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L387.7 253.7 410.3 231zM160 399.4l-9.1 22.7c-4 3.1-8.5 5.4-13.3 6.9L59.4 452l23-78.1c1.4-4.9 3.8-9.4 6.9-13.3l22.7-9.1 0 32c0 8.8 7.2 16 16 16l32 0zM362.7 18.7L348.3 33.2 325.7 55.8 314.3 67.1l33.9 33.9 62.1 62.1 33.9 33.9 11.3-11.3 22.6-22.6 14.5-14.5c25-25 25-65.5 0-90.5L453.3 18.7c-25-25-65.5-25-90.5 0zm-47.4 168l-144 144c-6.2 6.2-16.4 6.2-22.6 0s-6.2-16.4 0-22.6l144-144c6.2-6.2 16.4-6.2 22.6 0s6.2 16.4 0 22.6z";e.definition={prefix:a,iconName:s,icon:[n,i,r,o,l]},e.faPencil=e.definition,e.prefix=a,e.iconName=s,e.width=n,e.height=i,e.ligatures=r,e.unicode=o,e.svgPathData=l,e.aliases=r}(O)),O}var Nt=Pt();const Lt=({chatId:e,currentName:a})=>{const[s,n]=u.useState(a),[i,r]=u.useState(!1),{mutate:o,isPending:l}=Ae();return t.jsxs(Ee,{defaultOpen:!1,open:i,onOpenChange:d=>{d&&n(a),r(d)},children:[t.jsx(Re,{asChild:!0,children:t.jsx(M,{variant:"link",className:"ml-2",children:t.jsx(N,{icon:Nt.faPencil})})}),t.jsxs(Ie,{className:"sm:max-w-[500px]",children:[t.jsxs(Se,{children:[t.jsx(De,{children:"Rename chat"}),t.jsx(ke,{children:"Enter a new name for this chat."})]}),t.jsx("div",{className:"grid gap-4 py-4",children:t.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[t.jsx(Fe,{htmlFor:"rename",className:"text-right",children:"Chat name"}),t.jsx(Ge,{id:"rename",value:s,onChange:d=>n(d.target.value),className:"col-span-3",placeholder:"Enter a new name for this chat",disabled:l,onKeyDown:d=>{d.key==="Enter"&&s.trim()&&s!==a&&o({chatId:e,name:s.trim()},{onSuccess:()=>{r(!1)}})}})]})}),t.jsxs(Ve,{children:[t.jsx(M,{variant:"ghost",onClick:()=>{n(a),r(!1)},children:"Cancel"}),t.jsx(M,{onClick:()=>{s.trim()&&s!==a&&o({chatId:e,name:s.trim()},{onSuccess:()=>{r(!1)}})},disabled:l||!s.trim()||s===a,children:l?"Renaming...":"Rename"})]})]})]})};var _t="Toggle",ve=u.forwardRef((e,a)=>{const{pressed:s,defaultPressed:n=!1,onPressedChange:i,...r}=e,[o=!1,l]=R({prop:s,onChange:i,defaultProp:n});return t.jsx(_.button,{type:"button","aria-pressed":o,"data-state":o?"on":"off","data-disabled":e.disabled?"":void 0,...r,ref:a,onClick:ie(e.onClick,()=>{e.disabled||l(!o)})})});ve.displayName=_t;var y="ToggleGroup",[xe,Ut]=re(y,[ce]),be=ce(),K=C.forwardRef((e,a)=>{const{type:s,...n}=e;if(s==="single"){const i=n;return t.jsx(yt,{...i,ref:a})}if(s==="multiple"){const i=n;return t.jsx(Mt,{...i,ref:a})}throw new Error(`Missing prop \`type\` expected on \`${y}\``)});K.displayName=y;var[je,Ce]=xe(y),yt=C.forwardRef((e,a)=>{const{value:s,defaultValue:n,onValueChange:i=()=>{},...r}=e,[o,l]=R({prop:s,defaultProp:n,onChange:i});return t.jsx(je,{scope:e.__scopeToggleGroup,type:"single",value:o?[o]:[],onItemActivate:l,onItemDeactivate:C.useCallback(()=>l(""),[l]),children:t.jsx(Pe,{...r,ref:a})})}),Mt=C.forwardRef((e,a)=>{const{value:s,defaultValue:n,onValueChange:i=()=>{},...r}=e,[o=[],l]=R({prop:s,defaultProp:n,onChange:i}),d=C.useCallback(m=>l((p=[])=>[...p,m]),[l]),f=C.useCallback(m=>l((p=[])=>p.filter(c=>c!==m)),[l]);return t.jsx(je,{scope:e.__scopeToggleGroup,type:"multiple",value:o,onItemActivate:d,onItemDeactivate:f,children:t.jsx(Pe,{...r,ref:a})})});K.displayName=y;var[wt,Tt]=xe(y),Pe=C.forwardRef((e,a)=>{const{__scopeToggleGroup:s,disabled:n=!1,rovingFocus:i=!0,orientation:r,dir:o,loop:l=!0,...d}=e,f=be(s),m=ze(o),p={role:"group",dir:m,...d};return t.jsx(wt,{scope:s,rovingFocus:i,disabled:n,children:i?t.jsx(He,{asChild:!0,...f,orientation:r,dir:m,loop:l,children:t.jsx(_.div,{...p,ref:a})}):t.jsx(_.div,{...p,ref:a})})}),E="ToggleGroupItem",Ne=C.forwardRef((e,a)=>{const s=Ce(E,e.__scopeToggleGroup),n=Tt(E,e.__scopeToggleGroup),i=be(e.__scopeToggleGroup),r=s.value.includes(e.value),o=n.disabled||e.disabled,l={...e,pressed:r,disabled:o},d=C.useRef(null);return n.rovingFocus?t.jsx(Oe,{asChild:!0,...i,focusable:!o,active:r,ref:d,children:t.jsx(te,{...l,ref:a})}):t.jsx(te,{...l,ref:a})});Ne.displayName=E;var te=C.forwardRef((e,a)=>{const{__scopeToggleGroup:s,value:n,...i}=e,r=Ce(E,s),o={role:"radio","aria-checked":e.pressed,"aria-pressed":void 0},l=r.type==="single"?o:void 0;return t.jsx(ve,{...l,...i,ref:a,onPressedChange:d=>{d?r.onItemActivate(n):r.onItemDeactivate(n)}})}),At=K,Et=Ne;const Rt=Be("inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-muted hover:text-muted-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive whitespace-nowrap",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent shadow-xs hover:bg-accent hover:text-accent-foreground"},size:{default:"h-9 px-2 min-w-9",sm:"h-8 px-1.5 min-w-8",lg:"h-10 px-2.5 min-w-10"}},defaultVariants:{variant:"default",size:"default"}}),Le=u.createContext({size:"default",variant:"default"});function It({className:e,variant:a,size:s,children:n,...i}){return t.jsx(At,{"data-slot":"toggle-group","data-variant":a,"data-size":s,className:L("group/toggle-group flex w-fit items-center rounded-md data-[variant=outline]:shadow-xs",e),...i,children:t.jsx(Le.Provider,{value:{variant:a,size:s},children:n})})}function ae({className:e,children:a,variant:s,size:n,...i}){const r=u.useContext(Le);return t.jsx(Et,{"data-slot":"toggle-group-item","data-variant":r.variant||s,"data-size":r.size||n,className:L(Rt({variant:r.variant||s,size:r.size||n}),"min-w-0 flex-1 shrink-0 rounded-none shadow-none first:rounded-l-md last:rounded-r-md focus:z-10 focus-visible:z-10 data-[variant=outline]:border-l-0 data-[variant=outline]:first:border-l cursor-pointer",e),...i,children:a})}const St=({multipleMetadata:e})=>{var p;const{chatId:a}=de(),{dataSource:s,setDataSource:n}=I(),{data:i}=S(),{mutate:r}=Ze(),{t:o}=H(),l=c=>{c&&(a&&r({chatId:a,dataSource:c}),n(c))},d=a&&((p=i==null?void 0:i.find(c=>c.id===a))==null?void 0:p.data_source)||s,f=u.useMemo(()=>e==null?void 0:e.reduce((c,{name:b,metadata:g})=>{const{data_source:P}=g;return d===x.FILE&&(P===x.FILE||P===x.CATALOG)&&c.push(b),d===x.DATABASE&&P===x.DATABASE&&c.push(b),c},[]),[e,d]),m=()=>t.jsxs("div",{className:"absolute min-w-[270px] max-w-[600px] left-1/2 -translate-x-1/2 top-full mb-2 hidden bg-secondary text-secondary-foreground group-hover:block text-xs rounded px-2 py-1 shadow z-10",children:[o("selected_data_sources","Selected data sources:"),f&&(f==null?void 0:f.length)>0?t.jsx("ul",{className:"list-disc pl-5",children:f.map(c=>t.jsx("li",{className:"text-sm",children:c},c))}):t.jsx("div",{className:"text-sm",children:o("no_data_sources_selected","No data sources selected.")})]});return t.jsxs(It,{type:"single",value:d,onValueChange:l,className:"bg-muted rounded-md p-1 shadow-sm group relative",children:[m(),t.jsx(ae,{value:x.DATABASE,className:"text-sm",children:t.jsx("div",{className:"m-2",children:o("database")})}),t.jsx(ae,{value:x.FILE,className:"text-sm",children:t.jsx("div",{className:"m-2",children:o("registry_file")})})]})},z=u.lazy(()=>le(()=>import("./ResponseMessage-CFrQ6qOS.js"),__vite__mapDeps([3,1,2,4,5]),import.meta.url).then(e=>({default:e.ResponseMessage}))),w=()=>t.jsx("div",{className:"p-4 text-sm",children:"Loading component..."}),Dt=({message:e,messages:a,chatId:s,index:n})=>{var r;const i=(r=a[n+1])==null?void 0:r.id;return t.jsx("div",{className:"table table-fixed w-full",children:e.role==="user"?t.jsxs(t.Fragment,{children:[t.jsx(jt,{id:e.id,responseId:i,message:e.content,timestamp:e.created_at,chatId:s}),e.in_progress&&t.jsx(u.Suspense,{fallback:t.jsx(w,{}),children:t.jsx(z,{message:e,isLoading:!0,chatId:s})})]}):t.jsx(u.Suspense,{fallback:t.jsx(w,{}),children:t.jsx(z,{message:e,isLoading:!1,chatId:s})})})},kt=()=>{const{chatId:e}=de(),a=se(),{t:s}=H(),{data:n=[],status:i}=Ue({chatId:e}),{data:r}=S(),{mutate:o}=qe(),l=!(n!=null&&n.some(v=>v.in_progress)),{data:d}=$e(),{data:f}=Ke((d==null?void 0:d.map(v=>v.name))||[]),{hasMixedSources:m,allowedDataSources:p}=u.useMemo(()=>{if(!f)return{allowedDataSources:[],hasMixedSources:!1};const v=new Set;return f.forEach(({metadata:h})=>{const{data_source:j}=h;j===x.FILE||j===x.CATALOG?v.add(x.FILE):j===x.DATABASE&&v.add(x.DATABASE)}),{allowedDataSources:Array.from(v),hasMixedSources:v.has(x.FILE)&&v.has(x.DATABASE)}},[f]),c=r?r.find(v=>v.id===e):void 0,b=()=>{if(c!=null&&c.id){const v=(r==null?void 0:r.filter(h=>h.id!==c.id))||[];if(o({chatId:c.id}),v.length>0){const h=[...v].sort((j,A)=>{const D=j.created_at?new Date(j.created_at).getTime():0;return(A.created_at?new Date(A.created_at).getTime():0)-D});a(`/chats/${h[0].id}`)}else a(ne.CHATS)}},g=u.useRef(null);u.useEffect(()=>{const v=document.querySelector('[data-slot="scroll-area-viewport"]');g.current&&v&&setTimeout(()=>{g.current&&v&&(v.scrollTop=g.current.offsetTop)},100)},[n]);const P=()=>{if(!n||n.length===0)return t.jsx(u.Suspense,{fallback:t.jsx(w,{}),children:t.jsx(ht,{allowedDataSources:p,chatId:c==null?void 0:c.id})});const v=(()=>{for(let h=n.length-1;h>=0;h--)if(n[h].role==="assistant")return h;return-1})();return t.jsxs(t.Fragment,{children:[t.jsxs(Ye,{className:"flex flex-1 flex-col overflow-y-hidden pr-2 pb-4",children:[t.jsx(J,{className:"my-4 border-t"}),n.map((h,j,A)=>{if(h.role==="user")return t.jsx(Dt,{message:h,messages:A,chatId:c==null?void 0:c.id,index:j},j);if(h.role==="assistant"){const D=j===v;return t.jsx("div",{ref:D?g:void 0,children:t.jsx(u.Suspense,{fallback:t.jsx(w,{}),children:t.jsx(z,{message:h,isLoading:!!h.in_progress,chatId:c==null?void 0:c.id})})},j)}return null})]}),t.jsx(u.Suspense,{fallback:t.jsx(w,{}),children:t.jsx(Ct,{allowedDataSources:p,chatId:c==null?void 0:c.id,allowSend:l})})]})},T=()=>c?t.jsxs(t.Fragment,{children:[t.jsxs("h2",{className:"text-xl flex-1",children:[t.jsx("strong",{children:c.name||s("new_chat")}),t.jsx(Lt,{chatId:c.id,currentName:c.name})]}),t.jsx("div",{children:m&&t.jsx(St,{multipleMetadata:f})}),t.jsxs(M,{variant:"ghost",onClick:b,children:[t.jsx(N,{icon:ue.faTrash}),t.jsx("span",{className:"ml-2",children:s("delete_chat")})]})]}):null;return t.jsxs("div",{className:"p-6 h-full flex flex-col",children:[t.jsx("div",{className:"flex justify-between items-center gap-2 h-9",children:T()}),t.jsx(J,{className:"my-4 border-t"}),i==="pending"&&!(n!=null&&n.length)?t.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-200px)]",children:t.jsx(Je,{})}):P()]})},qt=Object.freeze(Object.defineProperty({__proto__:null,Chats:kt},Symbol.toStringTag,{value:"Module"}));export{ft as C,Ot as D,Ht as M,Bt as P,bt as a,mt as b,qt as c,me as f,Zt as p};
